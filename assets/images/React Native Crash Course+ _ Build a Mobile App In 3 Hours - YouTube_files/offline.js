(function(g){var window=this;'use strict';var iHN=function(W){var Y=new g.Km("und",new g.mz("Default","und",!0));Y.captionTracks=W.captionTracks;return Y},MR$=function(W){return new g.EJ(function(Y,k){var P=W.length,T=[];
if(P)for(var I=function(O,u){P--;T[O]=u;P==0&&Y(T)},X=function(O){k(O)},h,B=0;B<W.length;B++)h=W[B],g.vrV(h,g.hN(I,B),X);
else Y(T)})},QE=function(W){this.W=W},yE=function(){QE.apply(this,arguments)},tRK=function(){yE.apply(this,arguments)},qui=function(){yE.apply(this,arguments)},Rgw=function(){yE.apply(this,arguments)},HHK=function(){yE.apply(this,arguments)},ne1=function(){yE.apply(this,arguments)},pIh=function(){yE.apply(this,arguments)},G9K=function(){yE.apply(this,arguments)},K6z=function(){QE.apply(this,arguments)},EeN=function(){yE.apply(this,arguments)},JWc=function(){yE.apply(this,arguments)},s5w=function(){yE.apply(this,
arguments)},rW1=function(){yE.apply(this,arguments)},AWz=function(){yE.apply(this,arguments)},zgh=function(){yE.apply(this,arguments)},d4z=function(){yE.apply(this,arguments)},m4p=function(){yE.apply(this,arguments)},D4N=function(){yE.apply(this,arguments)},gez=function(){yE.apply(this,arguments)},F6z=function(){yE.apply(this,arguments)},wIc=function(){yE.apply(this,arguments)},Q5B=function(){QE.apply(this,arguments)},yW9=function(){yE.apply(this,arguments)},egc=function(){yE.apply(this,arguments)},
oe$=function(){yE.apply(this,arguments)},vec=function(){yE.apply(this,arguments)},Cp9=function(){yE.apply(this,arguments)},L69=function(){yE.apply(this,arguments)},U4Q=function(){yE.apply(this,arguments)},lvK=function(){yE.apply(this,arguments)},bHN=function(){yE.apply(this,arguments)},cWi=function(){QE.apply(this,arguments)},x4i=function(){QE.apply(this,arguments)},fvN=function(){QE.apply(this,arguments)},VRi=function(){yE.apply(this,arguments)},NT$=function(){yE.apply(this,arguments)},avp=function(){yE.apply(this,
arguments)},WQc=function(){yE.apply(this,arguments)},YJK=function(){yE.apply(this,arguments)},$Wc=function(){yE.apply(this,arguments)},kR1=function(){yE.apply(this,arguments)},P3c=function(){yE.apply(this,arguments)},TgN=function(){yE.apply(this,arguments)},jx1=function(){yE.apply(this,arguments)},I41=function(){yE.apply(this,arguments)},X9w=function(){yE.apply(this,arguments)},SJp=function(){yE.apply(this,arguments)},hxK=function(){yE.apply(this,arguments)},BgB=function(){yE.apply(this,arguments)},
Ovi=function(){yE.apply(this,arguments)},uA$=function(){yE.apply(this,arguments)},Zvz=function(){yE.apply(this,arguments)},ivc=function(){yE.apply(this,arguments)},M21=function(){yE.apply(this,arguments)},t2z=function(){yE.apply(this,arguments)},qJh=function(){yE.apply(this,arguments)},Rxi=function(){yE.apply(this,arguments)},Hvc=function(){yE.apply(this,arguments)},nd9=function(){yE.apply(this,arguments)},p9Q=function(){yE.apply(this,arguments)},GRj=function(){yE.apply(this,arguments)},KQh=function(){QE.apply(this,
arguments)},EdN=function(){yE.apply(this,arguments)},JU9=function(){yE.apply(this,arguments)},sxB=function(){yE.apply(this,arguments)},rUQ=function(){yE.apply(this,arguments)},AUh=function(){yE.apply(this,arguments)},zx1=function(){yE.apply(this,arguments)},dW9=function(){yE.apply(this,arguments)},mWi=function(){yE.apply(this,arguments)},DWK=function(){yE.apply(this,arguments)},gd$=function(){yE.apply(this,arguments)},FQK=function(){yE.apply(this,arguments)},w9i=function(){yE.apply(this,arguments)},
Qx9=function(){yE.apply(this,arguments)},yUK=function(){yE.apply(this,arguments)},exQ=function(){yE.apply(this,arguments)},odp=function(){yE.apply(this,arguments)},vdK=function(){yE.apply(this,arguments)},C3B=function(){yE.apply(this,arguments)},LQh=function(){yE.apply(this,arguments)},UWz=function(){yE.apply(this,arguments)},l4i=function(){yE.apply(this,arguments)},bvi=function(){yE.apply(this,arguments)},cUK=function(){yE.apply(this,arguments)},xWc=function(){yE.apply(this,arguments)},f4h=function(){yE.apply(this,
arguments)},V2Q=function(){yE.apply(this,arguments)},NgK=function(){yE.apply(this,arguments)},a4i=function(){yE.apply(this,arguments)},W$i=function(){yE.apply(this,arguments)},Yv$=function(){yE.apply(this,arguments)},$$h=function(){yE.apply(this,arguments)},kuQ=function(){yE.apply(this,arguments)},PKh=function(){yE.apply(this,arguments)},TMj=function(W){W=W.key||W.id;
if(!W)throw Error("Entity key is missing");return W},jv9=function(){if(ef)return ef();
var W={};ef=g.lN("PersistentEntityStoreDb",{bW:(W.EntityStore={SN:1},W.EntityAssociationStore={SN:2},W),shared:!1,upgrade:function(Y,k){k(1)&&g.sP(g.nJ(Y,"EntityStore",{keyPath:"key"}),"entityType","entityType");k(2)&&(Y=g.nJ(Y,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.sP(Y,"byParentEntityKey","parentEntityKey"),g.sP(Y,"byChildEntityKey","childEntityKey"))},
version:3});return ef()},Iuj=function(W){return g.FH(jv9(),W)},Xa1=function(W){return g.FH((0,g.U_Q)(),W)},oU=function(W){this.token=W},vX=function(W,Y){Y=Y===void 0?{}:Y;
g.Qq.call(this,g.lW$[W],Object.assign({},{name:"PESEncoderError",type:W},Y));this.type=W;this.level="WARNING";Object.setPrototypeOf(this,vX.prototype)},Svp=function(W){return new vX("WRONG_DATA_TYPE",{GE:W})},hPi=function(W){return W instanceof Error?new vX("UNKNOWN_ENCODE_ERROR",{originalMessage:W.message}):new vX("UNKNOWN_ENCODE_ERROR")},BMp=function(W){return W instanceof Error?new vX("UNKNOWN_DECODE_ERROR",{originalMessage:W.message}):new vX("UNKNOWN_DECODE_ERROR")},OMi=function(W,Y){W=W instanceof
vX?W:Y(W);
g.GH(W);throw W;},udp=function(){},ZMi=function(W,Y,k){try{return W.J(Y,k)}catch(P){OMi(P,hPi)}},iMQ=function(W){W=(new TextEncoder).encode(W).subarray(0,16);
var Y=new Uint8Array(16);Y.set(W);return Y},C4=function(W){this.W=W},tdi=function(W){var Y=Mdi[W];
if(Y)return Y;g.Kx(new g.Qq("Entity model not found.",{entityType:W}))},qvj=function(W,Y){this.W=W;
this.K=Y;this.J={}},HM$=function(W,Y){a:{W=RPN(W.K,Y.version);
try{var k=W.K(Y.data,Y.key);break a}catch(P){OMi(P,BMp)}k=void 0}return k},L4=function(W,Y,k){return W.W.objectStore("EntityStore").get(Y).then(function(P){if(P){if(k&&P.entityType!==k)throw Error("Incorrect entity type");
return HM$(W,P)}})},UB=function(W,Y,k){return k?(k=k.map(function(P){return L4(W,P,Y)}),g.ZS.all(k)):W.W.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(Y)).then(function(P){return P.map(function(T){return HM$(W,T)})})},bc=function(W,Y,k){var P=TMj(Y),T=RPN(W.K,1),I=Object.assign({},Y);
return W.W.objectStore("EntityStore").get(P).then(function(X){if(X){if(X.entityType!==k)throw Error("Incorrect entity type");I.entityMetadata||(X=HM$(W,X),I.entityMetadata=X.entityMetadata)}}).then(function(){var X={key:P,
entityType:k,data:ZMi(T,I,P),version:1};return g.ZS.all([g.KJ(W.W.objectStore("EntityStore"),X),nwB(W,I,k)])}).then(function(){lc(W,P,k);
return P})},pa9=function(W,Y,k){Y=Y.map(function(P){return bc(W,P,k)});
return g.ZS.all(Y)},cX=function(W,Y,k){if(k==null?0:k.e2){var P=new Set;
return Gup(W,Y,P).then(function(){for(var I=[],X=g.p(P),h=X.next();!h.done;h=X.next())I.push(cX(W,h.value));return g.ZS.all(I).then(function(){})})}var T=g.cg(Y).entityType;
return g.ZS.all([W.W.objectStore("EntityStore").delete(Y),K$i(W,Y)]).then(function(){lc(W,Y,T)})},EwK=function(W,Y){return g.de(W.W.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(Y)},function(k){return g.ZS.all([k.delete(),
K$i(W,k.cursor.primaryKey)]).then(function(){lc(W,k.cursor.primaryKey,Y);return g.Aj(k)})})},JRc=function(W,Y,k,P){var T=RPN(W.K,1);
return L4(W,Y,P).then(function(I){if(I){I=g.YS(I,k);var X={key:Y,entityType:P,data:ZMi(T,I,Y),version:1};return g.ZS.all([g.KJ(W.W.objectStore("EntityStore"),X),nwB(W,I,P)])}}).then(function(){lc(W,Y,P);
return Y})},lc=function(W,Y,k){var P=W.J[k];
P||(P=new Set,W.J[k]=P);P.add(Y)},svh=function(W,Y,k){var P=TMj(Y);
k=tdi(k);if(!k)return g.ZS.resolve([]);k=new k(Y);W=W.W.objectStore("EntityAssociationStore");Y=[];k=g.p(k.K());for(var T=k.next();!T.done;T=k.next())Y.push(g.KJ(W,{parentEntityKey:P,childEntityKey:T.value}));return g.ZS.all(Y).then(function(I){return I.map(function(X){return X[1]})})},K$i=function(W,Y){return W.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(Y))},nwB=function(W,Y,k){var P=TMj(Y);
return K$i(W,P).then(function(){return svh(W,Y,k)})},Gup=function(W,Y,k){if(k.has(Y))return g.ZS.resolve(void 0);
k.add(Y);return rRN(W,Y).then(function(P){return W.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(Y)).then(function(){return P})}).then(function(P){var T=g.ZS.resolve(void 0);
P=g.p(P);for(var I=P.next(),X={};!I.done;X={JJ:void 0},I=P.next())X.JJ=I.value,T=T.then(function(h){return function(){return Gup(W,h.JJ,k)}}(X));
return T}).then(function(){})},rRN=function(W,Y){var k=W.W.objectStore("EntityAssociationStore");
return k.index("byParentEntityKey").getAll(IDBKeyRange.only(Y)).then(function(P){var T=[];P=g.p(P);for(var I=P.next();!I.done;I=P.next())I=I.value,T.push(k.index("byChildEntityKey").getAll(I.childEntityKey));return g.ZS.all(T)}).then(function(P){var T=[];
P=g.p(P);for(var I=P.next();!I.done;I=P.next())I=I.value,I.length===1&&T.push(I[0].childEntityKey);return T})},xv=function(){},AR9=function(){this.W={};
this.W[0]=new xv;if(!g.Oi("aes_pes_encoder_killswitch")){var W=this.W;try{var Y=g.yq();var k=iMQ(Y);var P=new C4(new g.S8(k),new g.h7(k))}catch(T){throw W=T instanceof Error?new vX("KEY_CREATION_FAILED",{originalMessage:T.message}):new vX("KEY_CREATION_FAILED"),g.GH(W),W;}W[1]=P}},RPN=function(W,Y){Y=Y===void 0?0:Y;
W=W.W[Y];if(!W)throw Y=new vX("INVALID_ENCODER_VERSION",{GE:Y}),g.GH(Y),Y;return W},f4=function(W,Y){g.e.call(this);
this.token=W;this.W=Y;this.observers=[];W=new g.V0.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.yq());W.onmessage=this.K.bind(this);this.channel=W},VE=function(W,Y,k){var P,T,I,X;
return g.D(function(h){if(h.W==1)return g.m(h,Iuj(W.token),2);if(h.W!=3)return P=h.K,g.m(h,g.GX(P,["EntityStore","EntityAssociationStore"],Y,function(B){T=new qvj(B,W.W);return k(T)}),3);
I=h.K;T&&(X=T.J,Object.keys(X).length>0&&(W.channel.postMessage(X),zPw(W,X)));return h.return(I)})},N1=function(W,Y,k){return VE(W,{mode:"readwrite",
sR:!0},function(P){return bc(P,Y,k)})},d$1=function(W,Y){return VE(W,{mode:"readwrite",
sR:!0},function(k){return pa9(k,Y,"offlineOrchestrationActionWrapperEntity")})},m$1=function(W,Y){return VE(W,{mode:"readwrite",
sR:!0},function(k){return cX(k,Y)})},D$B=function(W){return VE(W,{mode:"readwrite",
sR:!0},function(Y){return EwK(Y,"videoPlaybackPositionEntity")})},aU=function(W,Y,k){return VE(W,{mode:"readonly",
sR:!0},function(P){return L4(P,Y,k)})},Wx=function(W,Y,k){return VE(W,{mode:"readonly",
sR:!0},function(P){return UB(P,Y,k)})},zPw=function(W,Y){W=g.p(W.observers);
for(var k=W.next();!k.done;k=W.next())k=k.value,k(Y)},gww=function(){var W,Y,k;
return g.D(function(P){if(P.W==1)return g.KC(P,2),g.m(P,g.LJ(),4);if(P.W!=2){W=P.K;if(!W||!g.e0()||typeof g.V0.BroadcastChannel==="undefined")return P.return();Y=new AR9;return P.return(new f4(W,Y))}k=g.Aq(P);k instanceof Error&&g.GH(k);return P.return()})},Yz=function(){F$Q||(F$Q=gww());
return F$Q},wa1=function(W){var Y;
W=(Y=W.options)==null?void 0:Y.persistenceOption;return W==="ENTITY_PERSISTENCE_OPTION_PERSIST"||W==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},QvN=function(W){var Y;
return g.D(function(k){return k.W==1?g.m(k,Yz(),2):(Y=k.K)?g.m(k,VE(Y,"readwrite",function(P){for(var T={},I=g.p(W),X=I.next(),h={};!X.done;h={QL:void 0,a_:void 0},X=I.next())h.QL=X.value,h.QL.entityKey&&wa1(h.QL)&&(h.a_=g.$8(h.QL.payload),X=void 0,h.QL.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(X=function(B){return function(){return bc(P,B.QL.payload[B.a_],B.a_)}}(h)),h.QL.type==="ENTITY_MUTATION_TYPE_DELETE"&&(X=function(B){return function(){return cX(P,B.QL.entityKey)}}(h)),h.QL.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(X=function(B){return function(){return JRc(P,B.QL.entityKey,B.QL.payload[B.a_],B.a_)}}(h)),X&&(T[h.QL.entityKey]=T[h.QL.entityKey]?T[h.QL.entityKey].then(X):X()));
return g.ZS.all(Object.values(T))}),0):k.return()})},yRc=function(W){var Y;
return g.D(function(k){if(k.W==1){Y=W.mutations;if(!Y||Y.length<=0)return k.return();if(g.J6){var P={type:"ENTITY_LOADED"};Y!==void 0&&(P.payload=Y);g.J6.dispatch(P)}return g.m(k,QvN(Y),2)}Y.length=0;g.G1(k)})},ePc=function(W){return W!==void 0},owi=function(W){var Y=g.$0();
Y=Object.assign({},Y);W=Object.assign({},W);for(var k in Y)W[k]?(Y[k]!==4&&(Y[k]=W[k]),delete W[k]):Y[k]!==2&&(Y[k]=4);Object.assign(Y,W);g.U3C(Y);JSON.stringify(Y);return Y},vw9=function(W){var Y,k;
return g.D(function(P){if(P.W==1)return g.m(P,g.LJ(),2);if(P.W!=3)return(Y=P.K)?g.m(P,g.TW(Y),3):P.return();k=P.K;return P.return(g.GX(k,["index","media","captions"],{mode:"readwrite",sR:!0},function(T){var I=IDBKeyRange.bound(W+"|",W+"~");T=[T.objectStore("index").delete(I),T.objectStore("media").delete(I),T.objectStore("captions").delete(I)];return g.ZS.all(T).then(function(){})}))})},CKw=function(){var W,Y;
return g.D(function(k){if(k.W==1)return g.m(k,g.LJ(),2);if(k.W!=3){W=k.K;if(!W)throw g.OP("rvdfd");return g.m(k,g.TW(W),3)}Y=k.K;return k.return(g.GX(Y,["index","media"],{mode:"readwrite",sR:!0},function(P){var T={};return g.re(P.objectStore("index"),{},function(I){var X=I.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),h=g.ZS.resolve(void 0);if(X){var B=X[1];X=X[2];T[B]=T[B]||{};var O;T[B][X]=g.fTC((O=I.getValue())==null?void 0:O.fmts)}else h=I.delete().then(function(){});
return g.ZS.all([g.Aj(I),h]).then(function(u){return g.p(u).next().value})}).then(function(){for(var I={},X=g.p(Object.keys(T)),h=X.next();!h.done;h=X.next()){h=h.value;
var B=T[h].v;I[h]=T[h].a&&B?1:2}var O=owi(I);return g.JPS(P.objectStore("media"),{},function(u){var Z=u.cursor.key.match(g.WwX);Z&&I[Z[1]]||P.objectStore("media").delete(u.cursor.key);return g.tS5(u)}).then(function(){return O})})}))})},L$h=function(W,Y){var k,P;
return g.D(function(T){if(T.W==1)return g.m(T,g.LJ(),2);if(T.W!=3){k=T.K;if(!k)throw g.OP("wct");return g.m(T,g.TW(k),3)}P=T.K;return g.m(T,g.GX(P,["captions"],{mode:"readwrite",sR:!0},function(I){var X=[];I=I.objectStore("captions");for(var h=0;h<Y.length;h++){var B=g.KJ(I,Y[h],W+"|"+Y[h].metadata.vss_id);X.push(B)}return g.ZS.all(X)}),0)})},U$w=function(W){var Y,k,P;
return g.D(function(T){if(T.W==1)return Y=IDBKeyRange.bound(W+"|",W+"~"),g.m(T,g.LJ(),2);if(T.W!=3){k=T.K;if(!k)throw g.OP("gactfv");return g.m(T,g.TW(k),3)}P=T.K;return T.return(P.getAll("captions",Y))})},luc=function(W){return g.D(function(Y){g.Pn(W,0);
return Y.return(vw9(W))})},bMB=function(W){return{context:g.lo(),
videoIds:W}},cRK=function(W){return{context:g.lo(),
playlistIds:W}},x$p=function(W){return{context:g.lo(),
offlinePlaylistSyncChecks:W}},fuh=function(){this.W=new Map},NMw=function(){Vd$||(Vd$=new fuh);
return Vd$},auw=function(W,Y){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:W},metadata:Y,statusCode:void 0,csn:void 0,can:void 0}},WYz=function(W,Y,k){if(!k){var P=P===void 0?!1:P;
k=W.W.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!k||P)k=g.OY(16),W.W.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",k)}W={flowNonce:k,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:Y.eventType};Y.metadata&&(W.flowMetadata=Y.metadata);Y.statusCode!==void 0&&(W.flowEventStatus=Y.statusCode);Y.csn&&(W.csn=Y.csn);Y.can&&(W.can=Y.can);g.W8("flowEvent",W,void 0)},YUi=function(W){var Y,k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5,z1,cd,ad,Mc,Ij,mV,jV,wB,L$,Iq,z,vk;
return g.D(function(m1){if(m1.W==1)return g.m(m1,VE(W,{mode:"readonly",sR:!0},function(k5){return UB(k5,"playbackData").then(function(EK){var K=EK.map(function(ew){return ew.transfer}).filter(function(ew){return!!ew}),Y5=EK.map(function(ew){return ew.offlineVideoPolicy}).filter(function(ew){return!!ew}),Jm=EK.filter(function(ew){return!!ew.key}).map(function(ew){return g.xS(g.cg(ew.key).entityId,"downloadStatusEntity")});
K=UB(k5,"transfer",K);Y5=UB(k5,"offlineVideoPolicy",Y5);Jm=UB(k5,"downloadStatusEntity",Jm);var XZ=K.then(function(ew){ew=ew.reduce(function(U2,Yh){(Yh==null?0:Yh.offlineVideoStreams)&&U2.push.apply(U2,g.ZX(Yh.offlineVideoStreams));return U2},[]).filter(function(U2){return!!U2});
return UB(k5,"offlineVideoStreams",ew)});
return g.ZS.all([K,Y5,XZ,Jm]).then(function(ew){var U2=g.p(ew);ew=U2.next().value;var Yh=U2.next().value;var $$=U2.next().value;U2=U2.next().value;return[EK,ew,Yh,$$,U2]})})}),2);
if(m1.W!=3)return Y=m1.K,g.m(m1,VE(W,{mode:"readonly",sR:!0},function(k5){return UB(k5,"mainDownloadsListEntity").then(function(EK){var K,Y5;return(Y5=(K=EK[0])==null?void 0:K.downloads)!=null?Y5:[]})}),3);
k=m1.K;P=g.p(Y);T=P.next().value;I=P.next().value;X=P.next().value;h=P.next().value;B=P.next().value;O=T;u=I;Z=X;M=h;t=B;q={};G={};J={};d={};A={};F=[];y=g.p(u);for(L=y.next();!L.done;L=y.next())(V=L.value)&&(q[V.key]=V);c=g.p(Z);for(X7=c.next();!X7.done;X7=c.next())(Id=X7.value)&&(G[Id.key]=Id);Sz=g.p(t);for(O2=Sz.next();!O2.done;O2=Sz.next())($5=O2.value)&&(J[$5.key]=$5);z1=g.p(M);for(cd=z1.next();!cd.done;cd=z1.next())(ad=cd.value)&&(d[ad.key]=ad);Mc=g.p(k);for(Ij=Mc.next();!Ij.done;Ij=Mc.next())mV=
Ij.value,jV=void 0,A[(jV=mV.videoItem)!=null?jV:""]=!0,mV.videoItem&&(L$=wB=void 0,Iq=(L$=(wB=g.cg(mV.videoItem))==null?void 0:wB.entityId)!=null?L$:"",F.push({externalVideoId:Iq}));z=O.filter(function(k5){if(!k5||!k5.key||!k5.offlineVideoPolicy)return!1;k5=g.cg(k5.key).entityId;k5=g.xS(k5,"downloadStatusEntity");var EK;return!(k5&&((EK=J[k5])==null?void 0:EK.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
vk=z.map(function(k5){var EK=q[k5.transfer],K=[];if(EK==null?0:EK.offlineVideoStreams)for(var Y5=g.p(EK.offlineVideoStreams),Jm=Y5.next();!Jm.done;Jm=Y5.next())(Jm=d[Jm.value])&&K.push(Jm);Y5=G[k5.offlineVideoPolicy];Jm=A;var XZ=k5==null?void 0:k5.playerResponseTimestamp,ew=g.cg(Y5.key).entityId;k5=g.xS(ew,"mainVideoEntity");if(Y5.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var U2="OFFLINE_VIDEO_STATE_DISABLED";Y5.expirationTimestamp&&Number(Y5.expirationTimestamp)<Date.now()/1E3&&(U2="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Y5.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")U2="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(EK==null?void 0:EK.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":U2="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":U2="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":U2="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":U2="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":U2="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":U2="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:U2="OFFLINE_VIDEO_STATE_UNKNOWN"}if(U2==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(EK==null?void 0:EK.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":U2="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":U2="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":U2=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}ew={id:ew,videoState:U2};if(EK==null?0:EK.cotn)ew.cotn=EK.cotn;if(EK==null?0:EK.maximumDownloadQuality)ew.selectedVideoQuality=EK==null?void 0:EK.maximumDownloadQuality;if(EK==null?0:EK.lastProgressTimeMs)ew.lastProgressTimeMs=EK.lastProgressTimeMs;XZ&&(ew.playerResponseSavedTimeMs=String(Number(XZ)*1E3));EK=String;XZ=0;K=g.p(K);for(U2=K.next();!U2.done;U2=K.next())if(U2=U2.value,U2.streamsProgress){U2=g.p(U2.streamsProgress);for(var Yh=U2.next();!Yh.done;Yh=U2.next()){var $$=
void 0;XZ+=Number(($$=Yh.value.numBytesDownloaded)!=null?$$:0)}}ew.downloadedBytes=EK(XZ);ew.selectedOfflineMode=Jm[k5]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Y5.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(ew.offlinePlaybackDisabledReason=Y5.offlinePlaybackDisabledReason);return ew});
return m1.return({offlineVideos:vk,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:F}}})})},$aB=function(){this.locks=navigator.locks},koB=function(){try{var W=g.Wp("ytglobal.locks_");
if(W)return W;var Y;if(Y=navigator){var k=navigator;Y="locks"in k&&!!k.locks}if(Y)return g.V0.localStorage&&g.V0.localStorage.getItem("noop"),W=new $aB,g.N6("ytglobal.locks_",W),W}catch(P){}},$z=function(){},P9w=function(){},TOK=function(W){if(W.includes(":"))throw Error("Invalid user cache name: "+W);
return W+":"+g.yq("CacheStorage get")},j2p=function(){return g.D(function(W){if(kz!==void 0)return W.return(kz);
kz=new Promise(function(Y){var k;return g.D(function(P){switch(P.W){case 1:return g.KC(P,2),g.m(P,Px.open("test-only"),4);case 4:return g.m(P,Px.delete("test-only"),5);case 5:g.s2(P,3);break;case 2:if(k=g.Aq(P),k instanceof Error&&k.name==="SecurityError")return Y(!1),P.return();case 3:Y("caches"in window),g.G1(P)}})});
return W.return(kz)})},XHK=function(){return g.D(function(W){if(W.W==1)return g.m(W,j2p(),2);
if(!W.K)return W.return(void 0);Ixh||(Ixh=new P9w);return W.return(Ixh)})},TU=function(W,Y,k){g.Kx(new g.Qq("Woffle: "+W,k?{cotn:k}:""));
Y instanceof Error&&g.Kx(Y)},SUj=function(W){var Y;
return g.D(function(k){if(k.W==1)return g.m(k,YUi(W),2);Y=k.K;g.W8("offlineStateSnapshot",Y);g.G1(k)})},jL=function(W){g.e.call(this);
var Y=this;this.api=W;this.zW={kRh:function(){return Y.W},
WtD:function(){return Y.K}};
typeof g.V0.BroadcastChannel!=="undefined"&&(this.W=new g.V0.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.yq()),this.W.onmessage=this.J.bind(this),this.K=new g.V0.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.yq()),this.K.onmessage=this.T.bind(this))},I$=function(W,Y){W.api.Ri("onOfflineOperationFailure",Y);
var k;(k=W.W)==null||k.postMessage(Y)},hT1=function(W,Y,k){var P=this;
this.L=W;this.N=Y;this.visibility=k;this.C=this.G=this.X=this.J=this.W=!1;this.T=new g.C_(function(){P.SZ()});
this.zW={PM:function(){return P.K},
SZ:function(){P.SZ()},
wDq:function(){return P.T}};
this.visibility.subscribe("visibilitystatechange",function(){P.R6()})},BOB=function(W){if(!W.J&&!W.W){var Y=koB();
if(Y){W.J=!0;var k=g.yq("OfflineLockManager");Y.request("woffle_orchestration_leader:"+k,{},function(){var P,T;return g.D(function(I){switch(I.W){case 1:return g.KC(I,2),W.K=new g.Xd,W.W=!0,W.J=!1,g.m(I,W.L(),4);case 4:return g.m(I,W.K.promise,5);case 5:g.s2(I,0);break;case 2:P=g.Aq(I),W.SZ(),P instanceof Error&&(T=P,T.args=[{name:"WoLockManagerError",f_:P.name}],g.GH(T)),g.G1(I)}})})}}},O_B=function(W){W.W&&(W.C=!0,X3(W))},u0$=function(W,Y){W.W&&(W.X=Y,X3(W))},Z_j=function(W,Y){W.W&&(W.G=Y,X3(W))},
X3=function(W){W.G&&W.X&&W.C&&W.visibility.isBackground()?g.L_(W.T,6E4):W.T.stop()},SL=function(W){var Y;
W.offlineDeleteReason=(Y=W.offlineDeleteReason)!=null?Y:"OFFLINE_DELETE_REASON_UNKNOWN";var k;W.offlineModeType=(k=W.offlineModeType)!=null?k:"OFFLINE_NOW";g.W8("offlineDeleteEvent",W)},hs=function(W,Y){var k=Y.videoId;
var P=Y.hj;Y=Y.offlineModeType;W.encryptedVideoId=k;W.cotn=P==null?void 0:P.cotn;W.offlineabilityFormatType=P==null?void 0:P.maximumDownloadQuality;var T;W.isRefresh=(T=P==null?void 0:P.isRefresh)!=null?T:!1;var I;W.softErrorCount=(I=P==null?void 0:P.transferRetryCount)!=null?I:0;W.offlineModeType=Y!=null?Y:"OFFLINE_NOW";(W.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&W.statusType==="UNKNOWN_STATUS_TYPE"||!W.transferStatusType&&!W.statusType)&&g.Kx(Error("Woffle unknown transfer status"));
g.W8("offlineTransferStatusChanged",W)},i_K=function(W){hs({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},W)},MS9=function(W,Y,k,P){P={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!P};Y&&k&&(Y=Math.floor(Y/1024).toFixed(),k=Math.floor(k/1024).toFixed(),P.alreadyDownloadedKbytes=Y,P.totalFetchedKbytes=Y,P.totalContentKbytes=k);hs(P,W)},tSh=function(W){hs({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},W)},qUQ=function(W){hs({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},W)},RTz=function(W){switch(W){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Bx=function(W){var Y,k,P;
return((P=(Y=W.actionMetadata)==null?void 0:(k=Y.retryScheduleIntervalsInSeconds)==null?void 0:k.length)!=null?P:0)>0},O3=function(W){return W.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!W.entityKey},uR=function(W){return W.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!W.entityKey},ZI=function(W){return W.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!W.entityKey},H_w=function(W){return W.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!W.entityKey},
iR=function(W,Y,k,P,T){T=T===void 0?!1:T;
var I,X,h,B,O,u;return g.D(function(Z){if(Z.W==1)return I=g.xS(W,Y),X=g.xS(W,"downloadStatusEntity"),g.m(Z,VE(k,{mode:"readonly",sR:!0},function(M){return g.ZS.all([L4(M,I,Y),L4(M,X,"downloadStatusEntity")])}),2);
h=Z.K;B=h.length?h[0]:void 0;if(!B)return Z.oi(0);O=nAQ;if(u=h.length>1?h[1]:void 0){if(u.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!T)return Z.return();u.downloadState=P}else u={key:X,downloadState:P};g.Ah(B,O,u);return g.m(Z,VE(k,{mode:"readwrite",sR:!0},function(M){return g.ZS.all([bc(M,B,Y),bc(M,u,"downloadStatusEntity")])}),0)})},MM=function(W,Y){return W.actionType===Y.actionType&&W.entityKey===Y.entityKey},ts=function(W,Y){if(W&&W.transferState!=="TRANSFER_STATE_COMPLETE"&&W.transferState!==
"TRANSFER_STATE_FAILED"){var k=g.cg(W.key).entityId;
hs({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:k,hj:W,offlineModeType:Y})}},qM=function(W){if(!W||!W.thumbnails)return[];
var Y=[];W=g.p(W.thumbnails);for(var k=W.next();!k.done;k=W.next())k=k.value,k.url&&Y.push(k.url);return Y},pHB=function(W,Y,k){k=k===void 0?[]:k;
var P,T,I,X,h,B,O,u,Z,M,t,q,G;return g.D(function(J){if(J.W==1)return k.length?g.m(J,Wx(W,Y),2):J.return([]);P=J.K;T=new Set;I=g.p(P);for(X=I.next();!X.done;X=I.next())if(h=X.value,B=h.id||h.key)O=g.cg(B).entityId,T.add(O);u=[];Z=g.p(k);for(M=Z.next();!M.done;M=Z.next())t=M.value,q=t.offlineVideoData,G=void 0,((G=q)==null?0:G.videoId)&&!T.has(q.videoId)&&u.push(t);return J.return(u)})},Go9=function(W,Y,k){return new g.t6(W,{cotn:Y,
raw_player_response:k,download_media:!0,start:Infinity,disable_watch_next:!0})},KYQ=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},R$=function(W,Y,k,P,T,I,X,h,B,O,u){this.entityType=W;
this.actionId=Y;this.action=k;this.parentActionId=P;this.rootActionId=T===void 0?Y:T;this.childActionIds=I;this.prereqActionId=X;this.postreqActionIds=h;this.hasChildActionFailed=O;this.retryScheduleIndex=0;this.W=u||Date.now();this.retryScheduleIndex=B||0},Hx=function(W){if(!W.key)throw Error("Entity key is required.");
if(!W.actionProto)throw Error("OfflineOrchestrationAction is required.");var Y=g.cg(W.key),k=g.cg(W.actionProto.entityKey);return new R$(k.entityType,Y.entityId,W.actionProto,W.parentActionId,W.rootActionId,W.childActionIds,W.prereqActionId,W.postreqActionIds,W.retryScheduleIndex,W.hasChildActionFailed,Number(W.enqueueTimeSec)*1E3)},np=function(W){return{key:g.xS(W.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:W.action,parentActionId:W.parentActionId,rootActionId:W.rootActionId,childActionIds:W.childActionIds,prereqActionId:W.prereqActionId,postreqActionIds:W.postreqActionIds,retryScheduleIndex:W.retryScheduleIndex,hasChildActionFailed:W.hasChildActionFailed,enqueueTimeSec:(W.W/1E3).toFixed()}},EAj=function(){var W;
return g.D(function(Y){return Y.W==1?g.m(Y,XHK(),2):(W=Y.K)?Y.return(W.delete("yt-player-local-img")):Y.return(!0)})},pp=function(W){var Y,k;
return g.D(function(P){if(P.W==1)return g.m(P,XHK(),2);if(P.W!=3){Y=P.K;if(!Y)throw Error("Cache API not supported");return W.length?g.m(P,Y.open("yt-player-local-img"),3):P.return()}k=P.K;return g.m(P,Promise.all(W.map(function(T){return k.delete(T)})),0)})},GU=function(W){var Y,k;
return g.D(function(P){if(P.W==1)return g.m(P,XHK(),2);if(P.W!=3){Y=P.K;if(!Y)throw Error("Cache API not supported");return W.length?g.m(P,Y.open("yt-player-local-img"),3):P.return()}k=P.K;return g.m(P,k.addAll(W),0)})},Kp=function(W,Y,k,P,T){var I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5,z1,cd,ad,Mc,Ij,mV,jV;
return g.D(function(wB){switch(wB.W){case 1:return I=g.xS(W,"mainVideoEntity"),X=g.xS(W,"ytMainChannelEntity"),h=g.xS(W,"transfer"),B=g.xS(W,"videoDownloadContextEntity"),g.m(wB,VE(Y,{mode:"readonly",sR:!0},function(L$){return g.ZS.all([L4(L$,I,"mainVideoEntity"),L4(L$,X,"ytMainChannelEntity"),L4(L$,h,"transfer"),L4(L$,B,"videoDownloadContextEntity"),UB(L$,"ytMainChannelEntity"),UB(L$,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:O=wB.K;u=g.p(O);Z=u.next().value;M=u.next().value;t=u.next().value;q=u.next().value;G=u.next().value;J=u.next().value;d=Z;A=M;F=t;y=q;L=G;V=J;if(!d&&!A){wB.oi(3);break}c=d?qM(d.thumbnail):[];if(!A){X7=[];wB.oi(4);break}return g.m(wB,JP9(A,L),5);case 5:X7=wB.K;case 4:return Id=X7,g.m(wB,pp(c.concat(Id)),3);case 3:Sz=[];O2=g.xS(W,"downloadStatusEntity");$5=g.p(V);for(z1=$5.next();!z1.done;z1=$5.next())cd=z1.value,ad=g.cg(cd.key).entityId,Mc=Hx(cd),Ij=g.cg(Mc.action.entityKey).entityId,ad!==W&&
Ij!==W||MM(k,cd.actionProto)||Sz.push(cd.key);return g.m(wB,VE(Y,{mode:"readwrite",sR:!0},function(L$){var Iq=Sz.map(function(z){return cX(L$,z)});
Iq.push(cX(L$,I,{e2:!0}));Iq.push(cX(L$,O2,{e2:!0}));return g.ZS.all(Iq)}),7);
case 7:jV=(mV=y)==null?void 0:mV.offlineModeType,T&&(SL(T),T.offlineModeType&&(jV=T.offlineModeType)),ts(F,jV),I$(P,{entityKey:I,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.G1(wB)}})},APh=function(W,Y,k,P){var T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5,z1,cd,ad,Mc,Ij,mV,jV,wB,L$,Iq,z,vk,m1,k5,EK,K,Y5,Jm,XZ,ew,U2,Yh,$$,CT,E;
return g.D(function(n){switch(n.W){case 1:return T=g.xS(W,"mainPlaylistEntity"),I=g.xS(W,"ytMainChannelEntity"),g.m(n,VE(Y,{mode:"readonly",sR:!0},function(r){return g.ZS.all([L4(r,T,"mainPlaylistEntity"),L4(r,I,"ytMainChannelEntity"),UB(r,"mainPlaylistEntity"),UB(r,"mainDownloadsListEntity"),UB(r,"ytMainChannelEntity"),UB(r,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=n.K;h=g.p(X);B=h.next().value;O=h.next().value;u=h.next().value;Z=h.next().value;M=h.next().value;t=h.next().value;q=B;G=O;J=u;d=Z;A=M;F=t;if(!q&&!G){n.oi(3);break}y=q?s2K(q):[];if(!G){L=[];n.oi(4);break}return g.m(n,JP9(G,A),5);case 5:L=n.K;case 4:return V=L,g.m(n,pp(y.concat(V)),3);case 3:c=[];X7=new Map;if(!q){n.oi(7);break}return g.m(n,rPz(q,J,d),8);case 8:c=n.K;Id=g.p(c);for(Sz=Id.next();!Sz.done;Sz=Id.next())O2=Sz.value,X7.set(O2,{videoId:O2,playlistId:W,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.m(n,VE(Y,{mode:"readonly",sR:!0},function(r){return g.ZS.all([UB(r,"transfer"),UB(r,"videoDownloadContextEntity")])}),9);
case 9:$5=n.K;z1=g.p($5);cd=z1.next().value;ad=z1.next().value;Mc=cd;Ij=ad;mV=g.p(Mc);for(jV=mV.next();!jV.done;jV=mV.next())wB=jV.value,L$=g.cg(wB.key).entityId,(Iq=X7.get(L$))&&wB&&(Iq.cotn=wB.cotn);z=g.p(Ij);for(vk=z.next();!vk.done;vk=z.next())m1=vk.value,k5=g.cg(m1.key).entityId,(EK=X7.get(k5))&&m1&&(EK.offlineModeType=m1.offlineModeType);case 7:K=[];Y5=g.p(F);for(Jm=Y5.next();!Jm.done;Jm=Y5.next())XZ=Jm.value,ew=g.cg(XZ.key).entityId,U2=Hx(XZ),ew!==W&&U2.rootActionId!==W||MM(k,XZ.actionProto)||
K.push(XZ.key);Yh=g.xS(W,"mainPlaylistEntity");return g.m(n,VE(Y,{mode:"readwrite",sR:!0},function(r){var w=K.map(function(C){return cX(r,C)});
w.push(cX(r,Yh,{e2:!0}));return g.ZS.all(w)}),10);
case 10:if(!q){n.oi(0);break}c.reverse();if(!c){n.oi(0);break}$$=g.p(c);CT=$$.next();case 13:if(CT.done){n.oi(0);break}E=CT.value;return g.m(n,Kp(E,Y,k,P,X7.get(E)),14);case 14:CT=$$.next(),n.oi(13)}})},da$=function(W,Y,k,P){var T,I,X,h,B,O,u,Z,M;
return g.D(function(t){if(t.W==1)return T=g.xS("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),I=new Map,g.m(t,VE(W,{mode:"readwrite",sR:!0},function(q){var G=UB(q,"transfer"),J=UB(q,"offlineOrchestrationActionWrapperEntity"),d=UB(q,"videoDownloadContextEntity"),A=L4(q,T,"mainDownloadsListEntity");return g.ZS.all([G,J,d,A]).then(function(F){F=g.p(F);var y=F.next().value;var L=F.next().value;var V=F.next().value;var c=F.next().value;F=zTi.map(function(Id){return EwK(q,Id)});
L=g.p(L);for(var X7=L.next();!X7.done;X7=L.next())X7=X7.value,MM(Y,X7.actionProto)||F.push(cX(q,X7.key,{e2:!0}));c&&(c.downloads=[],F.push(bc(q,c,"mainDownloadsListEntity")));if(V)for(V=g.p(V),c=V.next();!c.done;c=V.next())c=c.value,L=g.cg(c.key).entityId,L=g.xS(L,"transfer"),I.set(L,c.offlineModeType);return g.ZS.all(F).then(function(){return y})})}),2);
X=t.K;h=g.p(X);for(B=h.next();!B.done;B=h.next())O=B.value,ts(O,I.get(O.key)),u=g.cg(O.key).entityId,Z={videoId:u,offlineDeleteReason:P,cotn:O.cotn,offlineModeType:I.get(O.key)},SL(Z),M=g.xS(u,"mainVideoEntity"),I$(k,{entityKey:M,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.m(t,EAj(),0)})},s2K=function(W,Y){var k=[];
if(W.thumbnailStyleData){W=g.p(W.thumbnailStyleData);for(var P=W.next();!P.done;P=W.next()){var T=void 0,I=void 0,X=void 0;k=k.concat(qM((T=P.value)==null?void 0:(I=T.value)==null?void 0:(X=I.collageThumbnail)==null?void 0:X.coverThumbnail))}}Y=qM(Y);return k.concat(Y)},rPz=function(W,Y,k){var P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id;
return g.D(function(Sz){P=[];T=new Set;if(k.length)for(I=g.p(k),X=I.next();!X.done;X=I.next())if(h=X.value,B=void 0,(B=h.downloads)==null?0:B.length)for(O=g.p(h.downloads),u=O.next();!u.done;u=O.next())Z=u.value,Z.videoItem&&(M=g.cg(Z.videoItem).entityId,T.add(M));if(W.videos){t=g.p(W.videos);for(q=t.next();!q.done;q=t.next())G=q.value,J=JSON.parse(g.cg(G).entityId),J.videoId&&!T.has(J.videoId)&&P.push(J.videoId);d=g.p(Y);for(A=d.next();!A.done;A=d.next())if(F=A.value,F.key!==W.key&&(y=F.videos))for(L=
g.p(y),V=L.next();!V.done;V=L.next())c=V.value,X7=JSON.parse(g.cg(c).entityId),X7.videoId&&(Id=P.indexOf(X7.videoId),Id!==-1&&P.splice(Id,1))}return Sz.return(P)})},JP9=function(W,Y){var k,P,T,I,X,h,B,O;
return g.D(function(u){k=qM(W.avatar);P=g.p(Y);for(T=P.next();!T.done;T=P.next())if(I=T.value,I.id!==W.id)for(X=g.p(qM(I.avatar)),h=X.next();!h.done;h=X.next())B=h.value,O=k.indexOf(B),O!==-1&&k.splice(O,1);return u.return(k)})},maw=function(W){var Y;
return g.D(function(k){Y=g.U(W.frameworkUpdates,E3);return W.frameworkUpdates&&Y?g.m(k,yRc(Y),0):k.return()})},gAc=function(W){var Y;
if((Y=W.onResponseReceivedActions)!=null&&Y.length){var k;W=(k=g.U(g.U(W.onResponseReceivedActions[0],DaB),g.erc))==null?void 0:k.actions;if(W!=null&&W.length)return W}},FYj=function(W){var Y,k,P;
return g.D(function(T){if(T.W==1)return W?g.m(T,aU(W,g.eF,"mainDownloadsListEntity"),2):T.return([]);Y=T.K;return((k=Y)==null?0:(P=k.downloads)==null?0:P.length)?T.return(Y.downloads.map(function(I){var X;return(X=I.videoItem)!=null?X:""})):T.return([])})},Q2N=function(W,Y){var k;
return g.D(function(P){return P.W==1?g.m(P,wHj(W,Y),2):(k=P.K)?g.m(P,VE(W,{mode:"readwrite",sR:!0},function(T){var I=[bc(T,k.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];k.mainDownloadsListEntity&&I.push(bc(T,k.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.ZS.all(I)}),0):P.oi(0)})},wHj=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F;
return g.D(function(y){if(y.W==1)return k=g.xS("main_downloads_library_id","mainDownloadsLibraryEntity"),P=g.xS("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.m(y,VE(W,{mode:"readonly",sR:!0},function(L){return g.ZS.all([L4(L,k,"mainDownloadsLibraryEntity"),L4(L,P,"mainDownloadsListEntity")])}),2);
T=y.K;I=g.p(T);X=I.next().value;h=I.next().value;B=X;O=h;B||(B={id:k});u=g.p(Y);for(Z=u.next();!Z.done;Z=u.next())if(M=Z.value,M===g.eF){if(B.smartDownloadsList)return y.return();B.smartDownloadsList=M}else if(t=g.cg(M).entityType,q={},t==="mainPlaylistEntity"?q.playlistItem=M:t==="mainVideoEntity"&&(q.videoItem=M),!g.Ox(q)){G=void 0;if((G=O)==null?0:G.downloads){J=!1;d=g.p(O.downloads);for(A=d.next();!A.done;A=d.next())if(F=A.value,F.playlistItem===M||F.videoItem===M){J=!0;break}J||O.downloads.push(q)}else O=
{id:P,downloads:[q]};B.downloadsList=P}return y.return({mainDownloadsLibraryEntity:B,mainDownloadsListEntity:O})})},yPi=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J;
return g.D(function(d){if(d.W==1)return k=g.xS("main_downloads_library_id","mainDownloadsLibraryEntity"),P=g.xS("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.m(d,VE(W,{mode:"readonly",sR:!0},function(A){return g.ZS.all([L4(A,k,"mainDownloadsLibraryEntity"),L4(A,P,"mainDownloadsListEntity"),L4(A,g.eF,"mainDownloadsListEntity")])}),2);
T=d.K;I=g.p(T);X=I.next().value;h=I.next().value;B=I.next().value;O=X;u=h;Z=B;if(!O)return d.oi(0);if(Y===g.eF&&((M=Z)==null?0:M.downloads))Z.downloads=[];else if((t=u)==null?0:t.downloads)for(q=g.cg(Y).entityType,G=0;G<u.downloads.length;G++)if(J=u.downloads[G],q==="mainVideoEntity"&&J.videoItem===Y){u.downloads.splice(G,1);break}else if(q==="mainPlaylistEntity"&&J.playlistItem===Y){u.downloads.splice(G,1);break}return g.m(d,VE(W,{mode:"readwrite",sR:!0},function(A){var F=[bc(A,O,"mainDownloadsLibraryEntity")];
u&&F.push(bc(A,u,"mainDownloadsListEntity"));Z&&F.push(bc(A,Z,"mainDownloadsListEntity"));return g.ZS.all(F)}),0)})},Js=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M;
return g.D(function(t){if(t.W==1)return k=g.xS(Y,"transfer"),P=g.xS(Y,"videoDownloadContextEntity"),g.m(t,VE(W,{mode:"readonly",sR:!0},function(q){return g.ZS.all([L4(q,k,"transfer"),L4(q,P,"videoDownloadContextEntity")])}),2);
T=t.K;I=g.p(T);X=I.next().value;h=I.next().value;B=X;O=h;M={videoId:Y,cotn:(u=B)==null?void 0:u.cotn,offlineModeType:(Z=O)==null?void 0:Z.offlineModeType};return t.return(M)})},s3=function(W,Y,k,P,T){var I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7;
return g.D(function(Id){switch(Id.W){case 1:return I=g.xS(W,"musicTrack"),X=g.xS(W,"transfer"),g.m(Id,VE(Y,{mode:"readonly",sR:!0},function(Sz){return g.ZS.all([L4(Sz,I,"musicTrack"),L4(Sz,X,"transfer"),UB(Sz,"musicTrack"),UB(Sz,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=Id.K;B=g.p(h);O=B.next().value;u=B.next().value;Z=B.next().value;M=B.next().value;t=O;q=u;G=Z;J=M;if(!t){Id.oi(3);break}return g.m(Id,eTz(t,G),4);case 4:return d=Id.K,g.m(Id,pp(d),3);case 3:A=[];F=g.p(J);for(y=F.next();!y.done;y=F.next())L=y.value,V=g.cg(L.key).entityId,c=Hx(L),X7=g.cg(c.action.entityKey).entityId,V!==W&&X7!==W||MM(k,L.actionProto)||A.push(L.key);return g.m(Id,VE(Y,{mode:"readwrite",sR:!0},function(Sz){var O2=A.map(function($5){return cX(Sz,$5)});
O2.push(cX(Sz,I,{e2:!0}));return g.ZS.all(O2)}),6);
case 6:ts(q),T&&SL(T),I$(P,{entityKey:I,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.G1(Id)}})},rC=function(W,Y,k,P,T){var I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5,z1,cd,ad,Mc,Ij,mV,jV,wB,L$,Iq,z,vk;
return g.D(function(m1){switch(m1.W){case 1:return I=g.xS(W,Y),X=g.xS("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(m1,VE(k,{mode:"readonly",sR:!0},function(k5){return g.ZS.all([L4(k5,I,Y),L4(k5,X,"musicDownloadsLibraryEntity"),UB(k5,Y),UB(k5,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=m1.K;B=g.p(h);O=B.next().value;u=B.next().value;Z=B.next().value;M=B.next().value;t=O;q=u;G=Z;J=M;if(!t){m1.oi(3);break}return g.m(m1,eTz(t,G),4);case 4:return d=m1.K,g.m(m1,pp(d),3);case 3:A=[];F=new Map;if(!t){m1.oi(6);break}return g.m(m1,oA$(t,G,q),7);case 7:A=m1.K;y=g.p(A);for(L=y.next();!L.done;L=y.next())V=L.value,c=g.cg(V).entityId,F.set(c,{videoId:c,playlistId:W,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.m(m1,Wx(k,"transfer"),8);case 8:for(X7=m1.K,Id=
g.p(X7),Sz=Id.next();!Sz.done;Sz=Id.next())O2=Sz.value,$5=g.cg(O2.key).entityId,(z1=F.get($5))&&O2&&(z1.cotn=O2.cotn);case 6:cd=[];ad=g.p(J);for(Mc=ad.next();!Mc.done;Mc=ad.next())Ij=Mc.value,mV=g.cg(Ij.key).entityId,jV=Hx(Ij),mV!==W&&jV.rootActionId!==W||MM(P,Ij.actionProto)||cd.push(Ij.key);wB=g.xS(W,Y);return g.m(m1,VE(k,{mode:"readwrite",sR:!0},function(k5){var EK=cd.map(function(K){return cX(k5,K)});
EK.push(cX(k5,wB,{e2:!0}));return g.ZS.all(EK)}),9);
case 9:if(!t){m1.oi(0);break}A.reverse();if(!A.length){m1.oi(0);break}L$=g.p(A);Iq=L$.next();case 12:if(Iq.done){m1.oi(0);break}z=Iq.value;vk=g.cg(z).entityId;if(!vk){m1.oi(13);break}return g.m(m1,s3(vk,k,P,T,F.get(vk)),13);case 13:Iq=L$.next(),m1.oi(12)}})},As=function(W,Y,k){var P,T,I,X,h,B,O;
return g.D(function(u){if(u.W==1)return g.m(u,VE(W,{mode:"readwrite",sR:!0},function(Z){var M=UB(Z,"transfer"),t=UB(Z,"offlineOrchestrationActionWrapperEntity");return g.ZS.all([M,t]).then(function(q){q=g.p(q);var G=q.next().value;var J=q.next().value;q=vAi.map(function(y){return EwK(Z,y)});
J=g.p(J);for(var d=J.next();!d.done;d=J.next()){d=d.value;var A=g.cg(d.actionProto.entityKey).entityType==="musicTrack",F=d.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";MM(Y,d.actionProto)||A&&(!A||F)||q.push(cX(Z,d.key,{e2:!0}))}return g.ZS.all(q).then(function(){return G})})}),2);
P=u.K;T=g.p(P);for(I=T.next();!I.done;I=T.next())X=I.value,ts(X),h=g.cg(X.key).entityId,B={videoId:h,offlineDeleteReason:void 0,cotn:X.cotn},SL(B),O=g.xS(h,"musicTrack"),I$(k,{entityKey:O,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.m(u,EAj(),0)})},C9Q=function(W){for(var Y,k=g.p(W.additionalMetadatas),P=k.next();!P.done;P=k.next())P=P.value,P.offlineMusicVideoData&&(Y=P.offlineMusicVideoData);
var T,I,X,h,B;return{id:g.xS(W.videoId,"musicTrack"),videoId:W.videoId,title:W.title,thumbnailDetails:W.thumbnail,lengthMs:String(Number(W.lengthSeconds)*1E3),albumTitle:(T=Y)==null?void 0:T.releaseTitle,musicVideoType:(I=Y)==null?void 0:I.musicVideoType,contentRating:{explicitType:(X=Y)==null?void 0:X.explicitType},artistNames:((h=Y)==null?void 0:h.byline)||((B=Y)==null?void 0:B.channelName),downloadMetadata:g.xS(W.videoId,"musicTrackDownloadMetadataEntity")}},oA$=function(W,Y,k){var P,T,I,X,h,B,
O,u,Z,M,t,q,G,J,d,A,F,y;
return g.D(function(L){P=[];T=new Set;if((I=k)==null?0:(X=I.downloadedTracks)==null?0:X.length)for(h=g.p(k.downloadedTracks),B=h.next();!B.done;B=h.next())O=B.value,T.add(O);if(W.tracks){u=g.p(W.tracks);for(Z=u.next();!Z.done;Z=u.next())M=Z.value,T.has(M)||P.push(M);t=g.p(Y);for(q=t.next();!q.done;q=t.next())if(G=q.value,G.id!==W.id&&(J=G.tracks))for(d=g.p(J),A=d.next();!A.done;A=d.next())F=A.value,y=P.indexOf(F),y!==-1&&P.splice(y,1)}return L.return(P)})},eTz=function(W,Y){var k,P,T,I,X,h,B,O;
return g.D(function(u){k=qM(W.thumbnailDetails);P=g.p(Y);for(T=P.next();!T.done;T=P.next())if(I=T.value,I.id!==W.id)for(X=g.p(qM(I.thumbnailDetails)),h=X.next();!h.done;h=X.next())B=h.value,O=k.indexOf(B),O!==-1&&k.splice(O,1);return u.return(k)})},LYh=function(W,Y){var k,P,T,I,X,h,B,O,u;
return g.D(function(Z){if(Z.W==1)return k=g.xS("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(Z,aU(W,k,"musicDownloadsLibraryEntity"),2);(P=Z.K)||(P={id:k});T=g.cg(Y).entityType;T==="musicTrack"?(I=P.downloadedTracks)!=null&&I.includes(Y)||(P.downloadedTracks=((X=P.downloadedTracks)!=null?X:[]).concat(Y)):T==="musicPlaylist"?(h=P.downloadedPlaylists)!=null&&h.includes(Y)||(P.downloadedPlaylists=((B=P.downloadedPlaylists)!=null?B:[]).concat(Y)):T!=="musicAlbumRelease"||(O=P.downloadedAlbumReleases)!=
null&&O.includes(Y)||(P.downloadedAlbumReleases=((u=P.downloadedAlbumReleases)!=null?u:[]).concat(Y));return g.m(Z,N1(W,P,"musicDownloadsLibraryEntity"),0)})},Uaz=function(W,Y){var k,P,T,I,X,h,B;
return g.D(function(O){if(O.W==1)return k=g.xS("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(O,aU(W,k,"musicDownloadsLibraryEntity"),2);P=O.K;if(!P)return O.oi(0);T=g.cg(Y).entityType;T==="musicTrack"?I=P.downloadedTracks:T==="musicPlaylist"&&(I=P.downloadedPlaylists);if((X=I)==null?0:X.length)for(h=0;h<I.length;h++)if(B=I[h],B===Y){I.splice(h,1);break}return g.m(O,N1(W,P,"musicDownloadsLibraryEntity"),0)})},lxi=function(W){var Y=W.videos;
W=[];var k=[];if(Y){Y=g.p(Y);for(var P=Y.next();!P.done;P=Y.next()){var T=P.value.offlineVideoData.videoId;P=g.xS(T,"musicTrack");T=g.xS(T,"musicTrackDownloadMetadataEntity");W.push(P);k.push(T)}}return{Tl:W,J1:k}},zU=function(W,Y,k){Y={track:C9Q(Y)};
k&&(Y.playlistId=k);if(W=g.U(W.actionMetadata,b_j))Y.maximumDownloadQuality=W.maximumDownloadQuality;return{musicTrackEntityActionMetadata:Y}},xaN=function(W){var Y,k,P,T,I,X,h,B;
return g.D(function(O){switch(O.W){case 1:return Y=g.LS(),k=bMB(W),P=g.xm(cPK),g.KC(O,2),I={gO:!0},g.m(O,g.mR(Y,k,P,void 0,I),4);case 4:T=O.K;g.s2(O,3);break;case 2:X=g.Aq(O);if(X instanceof g.ol)throw h="GetOffline network manager error: "+X.message,TU(h,X),Error(h);TU("GetOffline fetch request error",X);throw Error("GetOffline fetch request error");case 3:B=dC(T);if(!T)throw TU("Network request failed"),Error("Network request failed");if(B!==void 0)mP(B);else if(!T.videos||!T.videos.length)throw TU("No data"),
Error("No data");return O.return(T.videos.map(function(u){return u.offlineVideoData}))}})},fxz=function(W){var Y,k,P,T,I,X,h,B;
return g.D(function(O){switch(O.W){case 1:return Y=g.LS(),k=cRK(W),P=g.xm(cPK),g.KC(O,2),I={gO:!0},g.m(O,g.mR(Y,k,P,void 0,I),4);case 4:T=O.K;g.s2(O,3);break;case 2:X=g.Aq(O);if(X instanceof g.ol)throw h="GetOffline network manager error for playlist: "+X.message,TU(h,X),Error(h);TU("GetOffline fetch request error for playlist",X);throw Error("GetOffline fetch request error for playlist");case 3:B=dC(T);if(!T)throw TU("Network request failed for playlist"),Error("Network request failed for playlist");
if(B!==void 0)mP(B,"playlist");else if(!T.playlists||!T.playlists.length)throw TU("No data for playlist"),Error("No data for playlist");return O.return(T.playlists.map(function(u){return u.offlinePlaylistData}))}})},NOh=function(W,Y,k,P){var T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5,z1,cd,ad,Mc,Ij;
return g.D(function(mV){switch(mV.W){case 1:return g.m(mV,Yz(),2);case 2:T=mV.K;if(!T)return mV.return([]);I=[];if((X=P)==null?0:X.length){I=P;mV.oi(3);break}return g.m(mV,Wx(T,"mainPlaylistEntity"),4);case 4:I=mV.K;case 3:if(!I.length)return mV.return([]);h=[];B=Date.now()/1E3;O=g.p(I);u=O.next();case 5:if(u.done)return h.length?g.m(mV,VSz(h),10):mV.return([]);Z=u.value;if(!Z.downloadState){M=void 0;mV.oi(8);break}return g.m(mV,aU(T,Z.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:M=
mV.K;case 8:t=M;q=void 0;J=(G=(q=Z)==null?void 0:q.entityMetadata)&&G.nextAutoRefreshIntervalSeconds?Number(G.nextAutoRefreshIntervalSeconds):NaN;d=Number.isNaN(J)?W:J;F=A=void 0;y=((A=t)==null?0:A.lastSyncedTimestampMillis)?Number((F=t)==null?void 0:F.lastSyncedTimestampMillis)/1E3:0;V=L=void 0;c=((L=t)==null?0:L.addedTimestampMillis)?Number((V=t)==null?void 0:V.addedTimestampMillis)/1E3:0;if(k||!G||y+d<=B){X7=[];Id=void 0;if((Id=Z.videos)==null?0:Id.length)for(Sz=g.p(Z.videos),O2=Sz.next();!O2.done;O2=
Sz.next())$5=O2.value,z1=JSON.parse(g.cg($5).entityId),z1.videoId&&X7.push(z1.videoId);cd="0";G&&(ad=void 0,cd=String(Number((ad=G.offlineLastModifiedTimestampSeconds)!=null?ad:0).toFixed()));Mc={playlistId:Z.playlistId,videoIds:X7,offlineLastModifiedTimestamp:cd,autoSync:Y,offlineDateAddedTimestamp:String(c.toFixed())};h.push(Mc)}u=O.next();mV.oi(5);break;case 10:return Ij=mV.K,mV.return(Ij)}})},axi=function(){var W,Y,k,P,T;
return g.D(function(I){if(I.W==1)return g.m(I,Yz(),2);if(I.W!=3)return(W=I.K)?g.m(I,Wx(W,"refresh"),3):I.return(!1);Y=I.K;if((k=Y[0])==null||!k.refreshTime)return I.return(!1);P=Number(Y[0].refreshTime);T=Date.now()/1E3;return I.return(isFinite(P)&&T>=P)})},YrB=function(W,Y){var k,P,T;
return g.D(function(I){switch(I.W){case 1:return g.KC(I,2),g.m(I,WH1(W,Y),4);case 4:return P=I.K,g.m(I,maw(P),5);case 5:k=gAc(P);g.s2(I,3);break;case 2:T=g.Aq(I),TU("getAndProcessSmartDownloadsResponse request or processing error",T);case 3:return I.return(k)}})},$9i=function(W,Y,k,P){var T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5,z1,cd,ad,Mc,Ij;
return g.D(function(mV){switch(mV.W){case 1:return g.m(mV,Yz(),2);case 2:T=mV.K;if(!T)return mV.return([]);I=[];if((X=P)==null?0:X.length){I=P;mV.oi(3);break}return g.m(mV,Wx(T,"musicPlaylist"),4);case 4:I=mV.K;case 3:if(!I.length)return mV.return([]);h=[];B=Date.now()/1E3;O=g.p(I);u=O.next();case 5:if(u.done)return h.length?g.m(mV,VSz(h),10):mV.return([]);Z=u.value;M=void 0;q=(t=(M=Z)==null?void 0:M.entityMetadata)&&t.nextAutoRefreshIntervalSeconds?Number(t.nextAutoRefreshIntervalSeconds):NaN;G=
Number.isNaN(q)?W:q;d=J=0;A="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!Z.downloadMetadata){mV.oi(8);break}return g.m(mV,aU(T,Z.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:F=mV.K,L=y=void 0,J=Number((L=(y=F)==null?void 0:y.addedTimestampMillis)!=null?L:"0")/1E3,c=V=void 0,d=Number((c=(V=F)==null?void 0:V.lastModifiedTimestampMillis)!=null?c:"0")/1E3,Id=X7=void 0,A=(Id=(X7=F)==null?void 0:X7.syncState)!=null?Id:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Sz=void 0;if(k||A!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!t||Number((Sz=t.lastSyncedTimestampSeconds)!=null?Sz:0)+G<=B){O2=[];$5=void 0;if(($5=Z.tracks)==null?0:$5.length)for(z1=g.p(Z.tracks),cd=z1.next();!cd.done;cd=z1.next())ad=cd.value,O2.push(g.cg(ad).entityId);Mc={playlistId:Z.playlistId,videoIds:O2,offlineLastModifiedTimestamp:String(d.toFixed()),autoSync:Y,offlineDateAddedTimestamp:String(J.toFixed())};h.push(Mc)}u=O.next();mV.oi(5);break;case 10:return Ij=mV.K,mV.return(Ij)}})},WH1=function(W,Y){var k,P,T,I,X,h,B,O,u,Z;
return g.D(function(M){switch(M.W){case 1:return k=g.LS(),g.m(M,Yz(),2);case 2:P=M.K;if(!P){M.oi(3);break}return g.m(M,YUi(P),4);case 4:T=M.K;case 3:var t=T;I={context:g.lo(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:W},offlineClientState:t,clientStateRequestData:{preferredFormatType:Y}}}};X=g.xm(kxz);g.KC(M,5);B={gO:!0};return g.m(M,g.mR(k,I,X,void 0,B),7);case 7:h=M.K;g.s2(M,6);break;case 5:O=g.Aq(M);if(O instanceof g.ol)throw u=
"DPS network manager error for smart downloads: "+O.message,TU(u,O),Error(u);TU("DPS fetch request error for smart downloads",O);throw Error("DPS fetch request error for smart downloads");case 6:Z=dC(h);if(h)Z!==void 0&&mP(Z,"smart downloads");else throw TU("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return M.return(h)}})},T9K=function(W,Y){var k,P,T,I,X,h,B,O;
return g.D(function(u){switch(u.W){case 1:return k=g.LS(),P={context:g.lo(),videoPlaybackPositionEntities:W,lastSyncTimestampUsec:Y},T=g.xm(Ps9),g.KC(u,2),X={gO:!0},g.m(u,g.mR(k,P,T,void 0,X),4);case 4:I=u.K;g.s2(u,3);break;case 2:h=g.Aq(u);if(h instanceof g.ol)throw B="VPPS network manager error: "+h.message,TU(B,h),Error(B);TU("VPPS fetch request error",h);throw Error("VPPS fetch request error");case 3:O=dC(I);if(I)O!==void 0&&mP(O,"position sync");else throw TU("Network request failed for position sync"),
Error("Network request failed for position sync");return u.return(I)}})},I3B=function(W,Y,k){var P,T,I,X,h,B,O,u;
return g.D(function(Z){switch(Z.W){case 1:P=g.LS();var M=k.refreshData,t=k.isEnqueuedForExpiredStreamUrlRefetch,q=k.r4,G=k.offlineSourceData,J=k.mediaCapabilities,d={entityKey:W};M&&(d.refreshData=M);t&&(d.isExpiredStreamUrlRefetch=t);q&&(d.downloadParameters=q);G&&(d.offlineSourceData=G);M={context:g.Kl(Y),signatureTimestamp:20319,videos:[d]};J&&(M.mediaCapabilities=J);T=M;I=g.xm(jYc);g.KC(Z,2);h={gO:!0};return g.m(Z,g.mR(P,T,I,void 0,h),4);case 4:X=Z.K;g.s2(Z,3);break;case 2:B=g.Aq(Z);if(B instanceof
g.ol)throw O="GetPDE network manager error: "+B.message,TU(O,B),Error(O);TU("GetPDE fetch request error",B);throw Error("GetPDE fetch request error");case 3:u=dC(X);if(X)u!==void 0&&mP(u,"PDE");else throw TU("Network request failed for PDE"),Error("Network request failed for PDE");return Z.return(X)}})},dC=function(W){var Y;
return(Y=W.errorMetadata)==null?void 0:Y.status},mP=function(W,Y){Y=Y?" for "+Y:"";
if(W===0)throw W="Empty response body"+Y,TU(W),Error(W);W="Response with error"+Y;TU(W);throw Error(W);},VSz=function(W){var Y,k,P,T,I,X,h,B;
return g.D(function(O){switch(O.W){case 1:return Y=g.LS(),k=x$p(W),P=g.xm(Xei),g.KC(O,2),I={gO:!0},g.m(O,g.mR(Y,k,P,void 0,I),4);case 4:T=O.K;g.s2(O,3);break;case 2:X=g.Aq(O);if(X instanceof g.ol)throw h="offlinePlaylistSyncCheck network manager error: "+X.message,TU(h,X),Error(h);TU("offlinePlaylistSyncCheck fetch request error",X);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:B=dC(T);if(!T)throw TU("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(B!==void 0)mP(B,"playlist sync");else if(!T.offlinePlaylistSyncCheckDatas||!T.offlinePlaylistSyncCheckDatas.length)throw TU("No data for playlist sync"),Error("No data for playlist sync");return O.return(T.offlinePlaylistSyncCheckDatas.map(function(u){return u.offlinePlaylistSyncCheckData}))}})},DI=function(W){this.W=W},Sr1=function(W,Y){var k,P,T,I,X,h;
return g.D(function(B){switch(B.W){case 1:k=new Map,P=g.p(Y),T=P.next();case 2:if(T.done){B.oi(4);break}I=T.value;X=k;h=X.set;return g.m(B,W.K(I),5);case 5:h.call(X,I,B.K);T=P.next();B.oi(2);break;case 4:return B.return(k)}})},gC=function(W,Y,k,P,T,I){Y=g.xS(Y,k);
P=Object.assign({},I,{priority:P,retryScheduleIntervalsInSeconds:T});return{actionType:W,entityKey:Y,actionMetadata:P}},F3=function(W,Y,k,P,T,I){this.status=W;
this.W=Y;this.T=k;this.K=P;this.J=T;this.downloadState=I},hZB=function(W,Y,k){this.W=W;
this.zJ=Y;this.J=k},uuK=function(W,Y){var k,P,T,I,X,h,B,O,u;
return g.D(function(Z){switch(Z.W){case 1:return k=Y.entityKey,T=(P=g.U(Y.actionMetadata,wC))==null?void 0:P.isEnqueuedForExpiredStreamUrlRefetch,g.KC(Z,2),I=void 0,g.m(Z,B9K(W,Y),4);case 4:I=Z.K;g.KC(Z,5);var M=(M=g.U(Y.actionMetadata,wC))?{maximumDownloadQuality:M.maximumDownloadQuality}:void 0;return g.m(Z,I3B(k,W.zJ,{isEnqueuedForExpiredStreamUrlRefetch:T,r4:M,offlineSourceData:I}),7);case 7:X=Z.K;g.s2(Z,6,2);break;case 5:return g.Aq(Z,2),h=Bx(Y)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",TU("PDE handleAdd error"),Z.return(Qd(Y,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",h,"DOWNLOAD_STATE_FAILED"));case 6:return g.m(Z,Ooj(W,X,Y),8);case 8:return Z.return(Qd(Y,!0,X.orchestrationActions));case 2:return B=g.Aq(Z),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.Iy&&B.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),TU("PDE handleAdd error"),Z.return(Qd(Y,!1,void 0,O,u,"DOWNLOAD_STATE_FAILED"))}})},MQK=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id;
return g.D(function(Sz){switch(Sz.W){case 1:return k=Y.entityKey,P=g.cg(k).entityId,g.m(Sz,VE(W.W,{mode:"readonly",sR:!0},function(O2){var $5=L4(O2,k,"playbackData"),z1=L4(O2,g.xS(P,"offlineVideoPolicy"),"offlineVideoPolicy");O2=L4(O2,g.xS(P,"transfer"),"transfer");return g.ZS.all([$5,z1,O2])}),2);
case 2:T=Sz.K;I=g.p(T);X=I.next().value;h=I.next().value;B=I.next().value;O=X;u=h;Z=B;if(!O||!u)return Sz.return(Qd(Y,!0));M=[];G=((q=O)==null?0:q.playerResponseJson)?JSON.parse(O.playerResponseJson):null;if(!(Z&&G&&W.zJ.U("html5_refresh_deprecated_downloads"))){Sz.oi(3);break}t=Zoz(W,G,Z);return g.m(Sz,io9(W,Z),4);case 4:M=Sz.K;case 3:J={lastPlayerResponseTimestampSeconds:O.playerResponseTimestamp,offlineToken:u.offlineToken,formatIds:M};d={};if((A=Z)==null?0:A.maximumDownloadQuality)d.maximumDownloadQuality=
Z.maximumDownloadQuality;g.KC(Sz,5);F=void 0;return g.m(Sz,B9K(W,Y),7);case 7:return F=Sz.K,g.KC(Sz,8),g.m(Sz,I3B(k,W.zJ,{refreshData:J,r4:d,offlineSourceData:F,mediaCapabilities:t}),10);case 10:y=Sz.K;g.s2(Sz,9,5);break;case 8:return g.Aq(Sz,5),L=Bx(Y)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",TU("PDE handleRefresh error"),Sz.return(Qd(Y,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",L,
"DOWNLOAD_STATE_FAILED"));case 9:return g.m(Sz,Ooj(W,y,Y),11);case 11:return Sz.return(Qd(Y,!0,y.orchestrationActions));case 5:return V=g.Aq(Sz),c="PDE handleRefresh error",V instanceof Error&&(c="PDE handleRefresh error: "+V.message),X7="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Id="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.Iy&&V.type==="QUOTA_EXCEEDED"&&(X7="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Id="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
TU(c),Sz.return(Qd(Y,!1,void 0,X7,Id,"DOWNLOAD_STATE_FAILED"))}})},B9K=function(W,Y){var k,P,T,I;
return g.D(function(X){if(X.W==1)return k=g.cg(Y.entityKey).entityId,P=g.xS(k,"videoDownloadContextEntity"),g.m(X,aU(W.W,P,"videoDownloadContextEntity"),2);T=X.K;return(I=T)!=null&&I.offlineModeType?X.return({offlineModeType:T.offlineModeType}):X.return(void 0)})},Ooj=function(W,Y,k){var P,T,I,X,h;
return g.D(function(B){if(B.W==1){if(!Y.frameworkUpdates||!g.U(Y.frameworkUpdates,E3))return B.return();if(!(g.U(Y.frameworkUpdates,E3).mutations&&g.U(Y.frameworkUpdates,E3).mutations.length>0&&g.U(Y.frameworkUpdates,E3).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return B.oi(2);P=g.cg(g.U(Y.frameworkUpdates,E3).mutations[0].entityKey).entityId;return g.m(B,Js(W.W,P),3)}if(B.W!=2){T=B.K;I=g.U(k.actionMetadata,wC);if(h=(X=I)==null?void 0:X.playlistId)T.playlistId=h;T.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.ph(W.zJ)?g.m(B,Kp(P,W.W,k,W.J,T),2):g.dq(W.zJ)?g.m(B,s3(P,W.W,k,W.J),2):B.oi(2)}return g.m(B,yRc(g.U(Y.frameworkUpdates,E3)),0)})},Qd=function(W,Y,k,P,T,I){return new F3(Y?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Bx(W),k,P,T,I)},Zoz=function(W,Y,k){Y=Go9(W.zJ,k.cotn,Y);
k=g.DG(Y);return g.miX(Y,k,W.zJ)},io9=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M;
return g.D(function(t){if(t.W==1)return k=[],g.m(t,VE(W.W,{mode:"readonly",sR:!0},function(q){var G=[],J=Y.offlineVideoStreams;if(J){J=g.p(J);for(var d=J.next();!d.done;d=J.next())G.push(L4(q,d.value,"offlineVideoStreams"))}return g.ZS.all(G)}),2);
if(P=t.K)for(T=g.p(P),I=T.next();!I.done;I=T.next())if(X=I.value,h=void 0,(h=X)==null?0:h.streamsProgress)for(B=X.streamsProgress,O=0;O<B.length;O++)u=B[O],Z=JSON.parse(u.formatStreamBytes),M={itag:Z.itag,lmt:Z.lastModified,xtags:Z.xtags},k.push(M);return t.return(k)})},tQN=function(W,Y){this.W=W;
this.zJ=Y},qrK=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t;
return g.D(function(q){switch(q.W){case 1:return k=Bx(Y),g.m(q,Wx(W.W,"videoPlaybackPositionEntity"),2);case 2:P=q.K;if(P.length===0)return q.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));g.KC(q,3);return g.m(q,oU.getInstance(),5);case 5:T=q.K;if(!T)throw Error("prefStorage is undefined");return g.m(q,T.get("psi"),6);case 6:return I=q.K,B=(h=(X=I)==null?void 0:X.hc)!=null?h:"0",g.m(q,T9K(P,B),7);case 7:return O=q.K,u={isPaused:O.watchHistoryPaused,hc:O.syncTimestampUsec},g.m(q,T.set("psi",
u),8);case 8:if(u.isPaused){q.oi(9);break}Z=g.U(O.frameworkUpdates,E3);if(!O.frameworkUpdates||!Z){q.oi(9);break}return g.m(q,yRc(Z),9);case 9:g.s2(q,4);break;case 3:return M=g.Aq(q),t="PPE handleRefresh error: "+(M instanceof Error?M.message:"unknown error"),TU(t),q.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return q.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},Ho1=function(W,Y){var k,P,T,I,X,h,B,O;
return g.D(function(u){switch(u.W){case 1:return k=Bx(Y),P=g.cg(Y.entityKey).entityId,g.KC(u,2),g.m(u,oU.getInstance(),4);case 4:T=u.K;if(!T)throw Error("prefStorage is undefined");return g.m(u,T.get("psi"),5);case 5:I=u.K;X=g.U(Y.actionMetadata,RZz);if(((h=I)==null?void 0:h.isPaused)!==!1||(B=X)==null||!B.lastPlaybackPositionSeconds){u.oi(6);break}O={key:g.xS(P,"videoPlaybackPositionEntity"),videoId:P,lastPlaybackPositionSeconds:X.lastPlaybackPositionSeconds};return g.m(u,N1(W.W,O,"videoPlaybackPositionEntity"),
6);case 6:g.s2(u,3);break;case 2:return g.Aq(u),u.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return u.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k))}})},nNh=function(W,Y){var k,P,T;
return g.D(function(I){switch(I.W){case 1:k=Bx(Y);g.KC(I,2);P=g.cg(Y.entityKey).entityId;if(P==="!*$_ALL_ENTITIES_!*$")return g.m(I,D$B(W.W),5);T=g.xS(P,"videoPlaybackPositionEntity");return g.m(I,m$1(W.W,T),5);case 5:g.s2(I,3);break;case 2:return g.Aq(I),I.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return I.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},pew=function(W,Y){this.api=W;
this.W=Y;this.logger=new g.H_("woffle");this.K=!1;this.zW={Yc:this.Yc};this.logger.debug("Initialized OfflineMediaManager")},Gx$=function(W){return g.D(function(Y){return Y.return(luc(W))})},KH1=function(W){var Y;
return g.D(function(k){if(k.W==1)return g.m(k,g.Vpd(W),2);Y=k.K;return k.return(Y.filter(function(P){return!!P.url}).map(function(P){return P.url}))})},yd=function(W,Y){var k=g.k0(Y);
if(k===1||k===0)return Promise.resolve();(k=ENQ(W,Y))&&k.stopVideo();W.J=0;return Gx$(Y)},eL=function(W,Y,k,P){k=k===void 0?!1:k;
P=P===void 0?!0:P;var T=typeof Y==="string"?Y:Y.videoDetails.videoId;g.k0(T)===2&&((Y=ENQ(W,T))?Y.stopVideo():W.logger.info(function(){return"Corresponding player for "+T+" not found. Pausing anyway"}),g.Pn(T,2),W.J=2,k?J4B(W.W):P&&sYw(W.W))},ENQ=function(W,Y){var k;
return((k=W.player)==null?void 0:k.getVideoData().videoId)===Y?W.player:null},r4h=function(W,Y,k){Y.getPlayerResponse();
g.Pn(Y.videoId,2);W.J=2;W.K=!1;var P;(P=W.player)==null||P.dispose();W.player=W.api.bx(Y);Y={};W.player.cH((Y.localmediachange=W.OO,Y.signatureexpired=W.zD,Y.statechange=W.O15,Y),W);W.U("html5_generate_content_po_token")&&W.player.O4();var T=W.Yc(k);W.player.CP(g.JM(T,T,!0,"m"),!1);W.logger.debug(function(){return"Starting headless playback with quality: "+T});
W.player.s$(!1)},A4Q=function(W,Y){this.W=W;
this.zJ=Y},d9$=function(W,Y){var k,P;
return g.D(function(T){switch(T.W){case 1:return k=Bx(Y),g.m(T,aU(W.W,Y.entityKey,"transfer"),2);case 2:if(P=T.K)return T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));g.KC(T,3);return g.m(T,zZi(W,Y),5);case 5:g.s2(T,4);break;case 3:return g.Aq(T),T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},m9Q=function(W,Y){var k,P;
return g.D(function(T){switch(T.W){case 1:return k=Bx(Y),g.m(T,aU(W.W,Y.entityKey,"transfer"),2);case 2:P=T.K;if(!P||P.transferState!=="TRANSFER_STATE_COMPLETE")return T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));g.KC(T,3);return g.m(T,zZi(W,Y,!0),5);case 5:g.s2(T,4);break;case 3:return g.Aq(T),T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k))}})},D9K=function(W,Y){var k,P,T,I,X,h,B,O,u,Z;
return g.D(function(M){switch(M.W){case 1:return k=Bx(Y),P=g.cg(Y.entityKey).entityId,g.m(M,VE(W.W,{mode:"readonly",sR:!0},function(t){var q=L4(t,Y.entityKey,"transfer");t=L4(t,g.xS(P,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.ZS.all([q,t])}),2);
case 2:T=M.K;I=g.p(T);X=I.next().value;h=I.next().value;B=X;O=h;if(!B||B.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return M.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));g.KC(M,3);B.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.m(M,N1(W.W,B,"transfer"),5);case 5:u=g.cg(B.key).entityId;tSh({videoId:u,hj:B,offlineModeType:(Z=O)==null?void 0:Z.offlineModeType});g.s2(M,4);break;case 3:return g.Aq(M),M.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return M.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k))}})},zZi=function(W,Y,k){k=k===void 0?!1:k;
var P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d;return g.D(function(A){switch(A.W){case 1:return P=g.U(Y.actionMetadata,gNB),T=g.cg(Y.entityKey).entityId,I=g.xS(T,"downloadStatusEntity"),g.m(A,VE(W.W,{mode:"readonly",sR:!0},function(F){var y=L4(F,I,"downloadStatusEntity");F=L4(F,g.xS(T,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.ZS.all([y,F])}),2);
case 2:return X=A.K,h=g.p(X),B=h.next().value,O=h.next().value,u=B,Z=O,M="TRANSFER_STATE_TRANSFER_IN_QUEUE",((t=u)==null?void 0:t.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(M="TRANSFER_STATE_PAUSED_BY_USER"),J={key:Y.entityKey,transferState:M,cotn:g.OY(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(q=P)==null?void 0:q.maximumDownloadQuality,preferredAudioTrack:(G=P)==null?void 0:G.preferredAudioTrack,transferRetryCount:0,isRefresh:k,hasLoggedFirstStarted:!1},g.m(A,VE(W.W,
{mode:"readwrite",sR:!0},function(F){var y=[];k&&y.push(cX(F,g.xS(T,"offlineVideoStreams")));y.push(bc(F,J,"transfer"));return g.ZS.all(y)}),3);
case 3:if(!k){A.oi(4);break}return g.m(A,Gx$(T),4);case 4:i_K({videoId:T,hj:J,offlineModeType:(d=Z)==null?void 0:d.offlineModeType}),g.G1(A)}})},wew=function(W,Y,k,P){if(!W.action.entityKey)throw Error("entityKey is missing.");
var T=g.cg(W.action.entityKey);T={entityType:T.ZL,entityId:T.entityId,offlineOrchestrationActionType:W.action.actionType,orchestrationAction:{orchestrationActionId:W.actionId}};Y&&(T.offlineOrchestrationActionResult=Y.status,T.isRetryable=k?!1:Y.W,Y.J&&(T.offlineOrchestrationFailureReason=FHK(Y.J,T.isRetryable)));var I,X;if((I=W.action.actionMetadata)==null?0:(X=I.offlineLoggingData)==null?0:X.offlineModeType)T.offlineModeType=W.action.actionMetadata.offlineLoggingData.offlineModeType;P&&(T.additionalOrchestrationActions=
P.map(function(h){return{orchestrationActionId:h.actionId}}));
return T},FHK=function(W,Y){return W!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||Y?W==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&Y?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":W:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},QY9=function(W,Y){var k={offlineOrchestrationContext:wew(W)};
Y=auw(Y,k);WYz(NMw(),Y,W.rootActionId)},y4h=function(W,Y,k,P){P=P===void 0?[]:P;
Y={offlineOrchestrationContext:wew(W,Y,k,P)};Y=auw(3,Y);WYz(NMw(),Y,W.rootActionId)},eZ$=function(){this.actions=[]},oNc=function(W,Y){Y=g.p(Y);
for(var k=Y.next();!k.done;k=Y.next())k=k.value,QY9(k,1),W.actions.push(k);W.actions.sort(W.W)},vN$=function(W,Y){if(Y)for(var k=0;k<W.actions.length;k++)if(Y==="!*$_ALL_ENTITIES_!*$"&&W.actions[k].actionId!==Y||Y!=="!*$_ALL_ENTITIES_!*$"&&W.actions[k].rootActionId===Y&&W.actions[k].actionId!==Y)W.actions.splice(k,1),k--},Csj=function(W,Y){W=g.p(W.actions);
for(var k=W.next();!k.done;k=W.next())if(k.value.actionId===Y)return!0;return!1},o$=function(W,Y,k,P,T){g.e.call(this);
var I=this;this.K=W;this.wD=Y;this.A5=k;this.G=P;this.zJ=T;this.W=new eZ$;this.X=new g.FJ;this.J=new g.C_(function(){I.retry()});
this.L=NaN;this.C=!1;this.zW={i5r:function(){return I.W},
pQ:function(){return I.X},
TkP:function(){return I.J},
retry:function(){return I.retry()}};
g.v(this,this.J);this.N=this.K.observe(this.Kg.bind(this))},l3h=function(W,Y,k,P,T){var I;
return g.D(function(X){if(X.W==1)return I=new o$(W,Y,k,P,T),g.m(X,LHB(I),2);U91(I);return X.return(I)})},U91=function(W){var Y=W.W.actions[0];
return W.T?((Y==null?void 0:Y.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&W.T[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(W.C=!0),Promise.resolve()):boz(W)},boz=function(W){var Y,k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d;
return g.D(function(A){switch(A.W){case 1:if(W.T)throw Error("Already processing an action");if(W.Xr())return A.return();Y=W.W.actions.shift();u0$(W.A5,!Y);if(Y===void 0)return A.return();Y.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&Y.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&vN$(W.W,Y.actionId);k="";Y.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&Y.rootActionId===Y.actionId&&(k=Y.actionId);P=[Y];W.T=P;if(T=W.wD[Y.entityType]){A.oi(2);break}W.T=
void 0;return g.m(A,boz(W),3);case 3:return A.return();case 2:I=g.p(P);for(X=I.next();!X.done;X=I.next())h=X.value,QY9(h,2);g.KC(A,4,5);return g.m(A,Sr1(T,P.map(function(F){return F.action})),7);
case 7:B=A.K,O=g.p(P),u=O.next();case 8:if(u.done){A.oi(10);break}Z=u.value;M=B.get(Z.action);return g.m(A,c4w(W,Z,M),9);case 9:u=O.next();A.oi(8);break;case 10:vN$(W.W,k);case 5:g.DX(A);W.T=void 0;g.gv(A,6);break;case 4:return t=g.Aq(A),TU("Orchestration error",t),g.KC(A,12),g.m(A,x9i(W,P),14);case 14:g.s2(A,5);break;case 12:q=g.Aq(A);TU("Orchestration retry error",q);G=g.p(P);for(J=G.next();!J.done;J=G.next())d=J.value,d.retryScheduleIndex<3&&oNc(W.W,[d]);A.oi(5);break;case 6:return g.m(A,boz(W),
0)}})},c4w=function(W,Y,k){var P,T,I,X,h,B,O,u,Z,M,t,q;
return g.D(function(G){switch(G.W){case 1:P=Y.retryScheduleIndex+2===3;if(k.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){G.oi(2);break}if(k.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){G.oi(0);break}y4h(Y,k,P);if(k.W&&Y.retryScheduleIndex+1<3)return g.m(G,x9i(W,[Y]),0);I=((T=k)==null?0:T.K)?k.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";X={entityKey:Y.action.entityKey,failureReason:I};h=void 0;g.ph(W.zJ)?h="mainVideoDownloadStateEntity":g.dq(W.zJ)&&(h="musicTrackDownloadMetadataEntity");
if(!h||!k.downloadState){G.oi(7);break}B=g.cg(Y.action.entityKey).entityId;return g.m(G,iR(B,h,W.K,k.downloadState),7);case 7:I$(W.G,X);if(k.downloadState==="DOWNLOAD_STATE_FAILED"&&W.zJ.U("html5_auto_retry_failed_pde_actions")){G.oi(0);break}TU("Orchestration result is not retryable, deleting action");return g.m(G,m$1(W.K,np(Y).key),0);case 2:O=void 0;try{O=(u=k.T)==null?void 0:u.map(function(J){return W.createAction(J,Y)})}catch(J){return y4h(Y,k,P),Z={entityKey:Y.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},I$(W.G,Z),TU("Orchestration subactions creation error",J),G.return()}y4h(Y,k,P,O);if(!O){G.oi(12);break}M=O.map(function(J){return np(J)});
t=0;case 13:if(!(t<O.length)||W.C){G.oi(15);break}return g.m(G,VE(W.K,{mode:"readwrite",sR:!0},function(J){var d=[];d.push(pa9(J,M.slice(t,t+10),"offlineOrchestrationActionWrapperEntity"));return g.ZS.all(d)}),16);
case 16:t+=10;G.oi(13);break;case 15:if(W.C)return W.C=!1,G.return();case 12:return q=np(Y),g.m(G,m$1(W.K,q.key),17);case 17:QY9(Y,4),g.G1(G)}})},a3K=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t;
return g.D(function(q){k=[];P=Infinity;T=4E3;I=g.p(Y);for(X=I.next();!X.done;X=I.next())h=X.value,B=Number(h.enqueueTimeSec),O=f3K(B),u=h.retryScheduleIndex,Z=u!=null&&u>0,O>0&&Z?(P=Math.min(P,B),T=Math.min(O,T)):k.push(h);isFinite(P)&&(!W.J.isActive()||P<W.L)&&(W.L=P,W.J.start(T));W.X.s6()||(M=k.length,k=k.filter(function(G){var J;G=((J=G.actionProto)==null?void 0:J.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!VQp.includes(G)}),t=k.length<M,!W.J.isActive()&&t&&W.J.start(1));
k.length>0&&N9j(W,k);return g.m(q,U91(W),0)})},YQi=function(W){var Y,k,P,T,I,X,h;
return g.D(function(B){if(B.W==1)return g.m(B,Wyi(W),2);Y=B.K;k=[];P=g.p(Y);for(T=P.next();!T.done;T=P.next())I=T.value,X=g.cg(I.key),h=X.entityId,Csj(W.W,h)||k.push(I);return g.m(B,a3K(W,k),0)})},f3K=function(W){W=W*1E3-Date.now();
return W>4E3?4E3:W},x9i=function(W,Y){var k,P,T;
return g.D(function(I){k=g.p(Y);for(P=k.next();!P.done;P=k.next()){T=P.value;var X=void 0,h=void 0,B=((h=T.action)==null?void 0:(X=h.actionMetadata)==null?void 0:X.retryScheduleIntervalsInSeconds)||[1,2,4];X=1;T.retryScheduleIndex<B.length&&(X=B[T.retryScheduleIndex]);T.W=X*1E3+Date.now();T.retryScheduleIndex++}return g.m(I,$CN(W,Y),0)})},LHB=function(W){var Y;
return g.D(function(k){if(k.W==1)return g.m(k,Wx(W.K,"offlineOrchestrationActionWrapperEntity"),2);Y=k.K;return g.m(k,a3K(W,Y),0)})},N9j=function(W,Y){Y.length!==0&&Y.forEach(function(k){k=Hx(k);
k.retryScheduleIndex<3&&oNc(W.W,[k])})},Wyi=function(W,Y){var k;
return g.D(function(P){if(P.W==1)return g.m(P,Wx(W.K,"offlineOrchestrationActionWrapperEntity",Y),2);k=P.K;return P.return(k.filter(ePc))})},$CN=function(W,Y){if(Y.length===0)return Promise.resolve([]);
Y=Y.map(function(k){return np(k)});
return d$1(W.K,Y)},ksc=function(W){this.Ii=W;
this.W=void 0},PGQ=function(W,Y){var k,P,T,I;
return g.D(function(X){k=Y.videoId;P=!0;if(Y.captionTracks.length)T=iHN(Y),W.W=new g.AJ(W.Ii,Y,T);else if(Y.Qa)I=g.Tmv(Y),W.W=new g.dK(W.Ii,Y.Qa,k,I,Y.wX,Y.eventId),P=Y.wX;else return X.return();return X.return(new Promise(function(h){var B;(B=W.W)==null||B.w7({BU:function(){return g.D(function(O){if(O.W==1)return g.m(O,W.BU(k,P),2);h();g.G1(O)})},
wP:function(){}})}))})},TFB=function(W){var Y;
return g.D(function(k){if(k.W==1)return g.m(k,U$w(W),2);Y=k.K;return k.return(!!Y&&Y.length>0)})},vx=function(W){g.e.call(this);
this.W=W;this.K=this.W.observe(this.J.bind(this))},jh9=function(W,Y){var k,P,T,I,X,h,B;
return g.D(function(O){switch(O.W){case 1:if(Y.length===0)return O.return([]);k=Y.map(function(u){return g.xS(u,"transfer")});
return g.m(O,Wx(W.W,"transfer",k),2);case 2:P=O.K;T=P.filter(ePc).map(function(u){return g.cg(u.key).entityId});
I=Y.filter(function(u){return T.indexOf(u)===-1});
if(I.length===0)return O.return([]);X=g.p(I);h=X.next();case 3:if(h.done){O.oi(5);break}B=h.value;return g.m(O,Gx$(B),4);case 4:h=X.next();O.oi(3);break;case 5:return O.return(I)}})},SQ9=function(W,Y,k,P,T,I){var X,h,B;
return g.D(function(O){X="STREAM_TYPE_UNKNOWN";k.video&&k.audio?(X="STREAM_TYPE_AUDIO_AND_VIDEO",TU("unexpected stream type")):k.video&&!k.audio?X="STREAM_TYPE_VIDEO":!k.video&&k.audio&&(X="STREAM_TYPE_AUDIO");h=g.xS(Y,"offlineVideoStreams");B={numBytesDownloaded:T.toFixed(),numTotalBytes:I.toFixed(),streamType:X,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(P),itag:X==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(k.itag):void 0};return g.m(O,VE(W,{mode:"readwrite",sR:!0},
function(u){var Z=L4(u,h,"offlineVideoStreams"),M=L4(u,g.xS(Y,"transfer"),"transfer");return g.ZS.all([Z,M]).then(function(t){t=g.p(t);var q=t.next().value;t=t.next().value;if(!t)return cX(u,h).then(function(){});
var G=IE9(q);q=XDc(q,P,B,h);var J=bc(u,q,"offlineVideoStreams");IE9(q)>G&&(t.lastProgressTimeMs=Date.now().toString());G=[J];t.offlineVideoStreams||(t.offlineVideoStreams=[]);t.offlineVideoStreams.indexOf(h)===-1&&(t.offlineVideoStreams.push(h),G.push(bc(u,t,"transfer")));return g.ZS.all(G)})}),0)})},hVj=function(W,Y){var k,P,T,I,X;
return g.D(function(h){if(h.W==1)return k=g.xS(Y,"offlineVideoStreams"),g.m(h,aU(W,k,"offlineVideoStreams"),2);P=h.K;if(!P||!P.streamsProgress)return h.return();T=g.p(P.streamsProgress);for(I=T.next();!I.done;I=T.next())X=I.value,X.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",X.numTotalBytes!==X.numBytesDownloaded&&(X.numBytesDownloaded=X.numTotalBytes);return g.m(h,N1(W,P,"offlineVideoStreams"),0)})},XDc=function(W,Y,k,P){if(W&&W.streamsProgress){P=W;
a:{Y=Y.itag+";"+Y.xtags;for(var T=W.streamsProgress,I=0;I<T.length;I++){var X=JSON.parse(T[I].formatStreamBytes);if(X.itag+";"+X.xtags===Y){T[I]=k;k=T;break a}}T.push(k);k=T}P.streamsProgress=k}else W={key:P,streamsProgress:[k]};return W},IE9=function(W){if(W==null?0:W.streamsProgress){var Y=0;
W=W.streamsProgress;for(var k=0;k<W.length;k++){var P=W[k];isNaN(Number(P.numBytesDownloaded))?TU("stream progress bytes number invalid"):Y+=Number(P.numBytesDownloaded)}return Y}return 0},BF$=function(W,Y,k,P){g.e.call(this);
var T=this;this.K=W;this.api=Y;this.GJ=k;this.Kg=P;this.X=new g.FJ;this.T=new g.C_(function(){T.W&&T.W.transferState==="TRANSFER_STATE_TRANSFERRING"&&T.X.s6()&&((T.W.transferRetryCount||0)<3?eL(T.G,T.C,!1,!1):yd(T.G,T.C.videoDetails.videoId),T.kX("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.A5=this.TJ=0;this.N=this.L=!1;this.V5=g.W2(this.api.V().experiments,"html5_transfer_processing_logs_interval");this.Fr=new g.p5(this);this.zW={tDS:function(){return T.T},
Lfz:function(){return T.Kg},
pQ:function(){return T.X}};
this.wD=this.K.observe(this.UC.bind(this));this.G=new pew(Y,this);this.rD=new ksc(Y);this.gD=new vx(this.K);this.UP=this.X.listen("publicytnetworkstatus-online",this.WB.bind(this));this.OP=this.X.listen("publicytnetworkstatus-offline",this.MLJ.bind(this));this.N=this.api.V().U("html5_less_transfer_processing_logs");g.v(this,this.Fr);this.Fr.Z(Y,"offlinetransferpause",this.zz5);if(g.ph(this.api.V()))this.J="mainVideoDownloadStateEntity";else if(g.dq(this.api.V())||g.Kh(this.api.V()))this.J="musicTrackDownloadMetadataEntity"},
OIi=function(W){return g.D(function(Y){if(Y.W==1)Y=g.m(Y,CKw(),2);
else{var k=W.gD;var P=g.$0();P=Object.keys(P);k=jh9(k,P);Y=g.m(Y,k,0)}return Y})},Lp=function(W,Y){Y=Y===void 0?!1:Y;
var k;return g.D(function(P){if(P.W==1){if(W.W)throw Error("Already downloading a video");W.A5=0;W.L=!1;return g.m(P,ubN(W),2)}return P.W!=4?(k=P.K,Z_j(W.GJ,!k),k&&W.X.s6()?Y?g.m(P,new Promise(function(T){g.Ii(T,1E3)}),4):P.oi(4):(!k&&W.W&&Cp(W),P.oi(0))):g.m(P,ZIp(W,k),0)})},iI$=function(W){return g.D(function(Y){if(Y.W==1)return W.C?g.m(Y,yd(W.G,W.C.videoDetails.videoId),3):Y.oi(0);
Cp(W);g.G1(Y)})},MMB=function(W,Y){var k,P,T;
return g.D(function(I){switch(I.W){case 1:return g.KC(I,2),(k=!!Y.captionTracks.length||!!Y.Qa)?g.m(I,TFB(Y.videoId),4):I.return();case 4:return(P=I.K)?I.return():g.m(I,PGQ(W.rD,Y),5);case 5:g.s2(I,0);break;case 2:T=g.Aq(I),TU("Caption downloading error",T,Y.cotn),g.G1(I)}})},ZIp=function(W,Y){var k,P,T,I,X,h;
return g.D(function(B){switch(B.W){case 1:if(W.L)return B.return();W.L=!0;W.W=Y;k=g.cg(W.W.key);P=k.entityId;T=void 0;if(W.W.transferState==="TRANSFER_STATE_TRANSFERRING")return g.m(B,U3(W,P),7);if(W.W.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||W.W.transferRetryCount||W.W.hasLoggedFirstStarted){B.oi(3);break}return g.m(B,U3(W,P),5);case 5:return T=B.K,W.W.hasLoggedFirstStarted=!0,g.m(B,tMz(W),6);case 6:MS9({videoId:P,hj:W.W,offlineModeType:T},void 0,void 0,!0);B.oi(3);break;case 7:T=B.K,
hs({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:P,hj:W.W,offlineModeType:T});case 3:return g.m(B,qQi(W),8);case 8:return I=null,g.KC(B,9),g.m(B,RV1(W,Y),11);case 11:I=B.K;W.C=I;g.s2(B,10);break;case 9:return X=g.Aq(B),TU("error getting player response",X,Y.cotn),g.m(B,W.kX("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return B.return();case 10:return h=Go9(W.api.V(),Y.cotn,I),g.m(B,MMB(W,h),13);case 13:return g.m(B,KH1(h.videoId),
14);case 14:h.GU=B.K,r4h(W.G,h,Y.maximumDownloadQuality),W.T.start(108E5),g.G1(B)}})},ubN=function(W){var Y,k;
return g.D(function(P){if(P.W==1)return g.m(P,Wx(W.K,"transfer"),2);Y=P.K;k=Y.filter(HI1).sort(nKc);return k.length===0?P.return():P.return(k[0])})},qQi=function(W){var Y,k,P;
return g.D(function(T){if(T.W==1){if(!W.W)return lR(W,"onTransferStart"),T.return();W.T.start(108E5);return g.m(T,bR(W,"TRANSFER_STATE_TRANSFERRING"),2)}Y=W.W;return(P=((k=Y)==null?0:k.key)?g.cg(Y.key).entityId:"")&&W.J?g.m(T,iR(P,W.J,W.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):T.oi(0)})},J4B=function(W){var Y,k,P,T;
g.D(function(I){switch(I.W){case 1:if(!W.W){lR(W,"onTransferPausedByUser");I.oi(2);break}Y=W.W;W.T.stop();return g.m(I,bR(W,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:P=((k=Y)==null?0:k.key)?g.cg(Y.key).entityId:"";if(!P||!W.J){I.oi(4);break}return g.m(I,iR(P,W.J,W.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.m(I,U3(W,P),6);case 6:T=I.K,qUQ({videoId:P,hj:Y,offlineModeType:T});case 2:Cp(W),Lp(W),g.G1(I)}})},sYw=function(W){var Y,k,P;
g.D(function(T){if(T.W==1){if(!W.W)return lR(W,"onTransferPausedByNetwork"),T.return();W.T.stop();return g.m(T,bR(W,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(T.W!=3)return Y=W.W,(P=((k=Y)==null?0:k.key)?g.cg(Y.key).entityId:"")&&W.J?g.m(T,iR(P,W.J,W.K,"DOWNLOAD_STATE_PAUSED"),3):T.oi(3);Cp(W);g.G1(T)})},pDi=function(W){var Y,k,P,T,I;
g.D(function(X){switch(X.W){case 1:if(!W.W)return lR(W,"onTransferComplete"),X.return();Y=W.W;W.T.stop();if(!Y||!W.C){X.oi(2);break}k=Go9(W.api.V(),Y.cotn,W.C);return g.m(X,MMB(W,k),2);case 2:return g.m(X,bR(W,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:T=((P=Y)==null?0:P.key)?g.cg(Y.key).entityId:"";if(!T||!W.J){X.oi(5);break}return g.m(X,iR(T,W.J,W.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.m(X,hVj(W.K,T),7);case 7:return g.m(X,U3(W,T),8);case 8:I=X.K,hs({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:T,hj:Y,offlineModeType:I}),Cp(W),Lp(W),g.G1(X)}})},Gsw=function(W,Y,k){var P,T;
g.D(function(I){switch(I.W){case 1:if(!W.W)return lR(W,"onTransferProgress: "+Y),I.return();if(W.W.transferState==="TRANSFER_STATE_TRANSFERRING"){I.oi(2);break}return g.m(I,qQi(W),2);case 2:P=Date.now();if(!(P-W.TJ>1E3)){I.oi(4);break}W.TJ=P;return g.m(I,SQ9(W.K,k.videoId,k.K,k.yA,k.bytesDownloaded,k.W),5);case 5:if(W.N&&!(W.N&&P-W.A5>W.V5)){I.oi(4);break}W.A5=P;return g.m(I,U3(W,Y),7);case 7:T=I.K,MS9({videoId:Y,hj:W.W,offlineModeType:T},k.bytesDownloaded,k.W);case 4:W.T.start(108E5),g.G1(I)}})},
KyB=function(W){var Y=(W.W.transferRetryCount||0)<3;
Y&&(W=W.W,W.transferRetryCount=(W.transferRetryCount||0)+1);return Y},EKj=function(W,Y){Y=Y===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":Y;
var k,P,T,I;return g.D(function(X){if(X.W==1)return W.W||lR(W,"setTransferToFailed: "+Y),k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y==="TRANSFER_FAILURE_REASON_NETWORK"?k="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":Y==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.m(X,bR(W,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",Y),2);if(X.W!=3)return I$(W.Kg,{entityKey:(P=W.W)==null?void 0:P.key,failureReason:k}),
T=W.W?g.cg(W.W.key).entityId:"",g.m(X,U3(W,T),3);I=X.K;var h={videoId:T,hj:W.W,offlineModeType:I},B=Y,O={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};B&&(O.transferFailureReason=B,O.failureReason=RTz(B));hs(O,h);g.G1(X)})},bR=function(W,Y,k,P){var T;
return g.D(function(I){if(I.W==1){if(!W.W)return lR(W,"saveTransferState: "+Y),I.return();W.W.transferState=Y;W.W.failureReason=P;g.KC(I,2);return g.m(I,tMz(W,function(X){return k?UB(X,"offlineVideoStreams",W.W.offlineVideoStreams).then(function(h){for(var B=g.p(h),O=B.next();!O.done;O=B.next())if((O=O.value)&&O.streamsProgress){O=g.p(O.streamsProgress);for(var u=O.next();!u.done;u=O.next())u.value.streamState=k}return pa9(X,h.filter(function(Z){return!!Z}),"offlineVideoStreams")}):g.ZS.resolve(void 0)}),
4)}if(I.W!=2)return g.s2(I,0);
T=g.Aq(I);return T instanceof g.Iy&&T.type==="QUOTA_EXCEEDED"?g.m(I,W.kX("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):I.oi(0)})},tMz=function(W,Y){var k;
return g.D(function(P){if(!W.W)return P.return();k=W.W;return g.m(P,VE(W.K,{mode:"readwrite",sR:!0},function(T){var I=[bc(T,k,"transfer")];Y&&I.push(Y(T));return g.ZS.all(I)}),0)})},Cp=function(W){W.W=void 0;
W.C=void 0;W.T.stop()},RV1=function(W,Y){var k,P,T,I,X;
return g.D(function(h){if(h.W==1)return k=g.cg(Y.key),P=k.entityId,T=g.xS(P,"playbackData"),g.m(h,aU(W.K,T,"playbackData"),2);I=h.K;if((X=I)==null?0:X.playerResponseJson)return h.return(JSON.parse(I.playerResponseJson));throw Error("No PlayerResponse found");})},lR=function(W,Y){W.api.y5("woffle",{mcte:Y});
TU("missing current transfer entity.")},U3=function(W,Y){var k,P,T;
return g.D(function(I){if(I.W==1)return g.m(I,aU(W.K,g.xS(Y,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);k=I.K;return I.return((T=(P=k)==null?void 0:P.offlineModeType)!=null?T:void 0)})},HI1=function(W){return JrK[W.transferState]!==void 0},nKc=function(W,Y){var k=JrK[W.transferState],P=JrK[Y.transferState];
return k!==P?k-P:Number(W.enqueuedTimestampMs)-Number(Y.enqueuedTimestampMs)},cx=function(W,Y){var k=this;
this.zJ=W;this.api=Y;this.X=new g.FJ;this.C=new g.Xd;this.zW={PM:function(){return k.J.zW.PM()},
pQ:function(){return k.X},
h$h:function(){return k.J},
m6:function(){return k.m6()},
z6:function(){return k.z6()},
ye:function(){return k.ye()},
ox:function(){return k.ox()},
Pc:function(){return k.Pc()},
zL:function(P){return k.zL(P)}};
this.J=new hT1(function(){return shp(k)},function(){k.ye()},this.api.qz(),this.api.U.bind(this.api));
this.W=new jL(this.api);BOB(this.J)},shp=function(W){return g.D(function(Y){W.api.Ri("onOrchestrationBecameLeader");
return g.m(Y,W.z6(),0)})},ArK=function(W){var Y,k;
return g.D(function(P){if(P.W==1)return g.m(P,Yz(),2);if(P.W!=3){Y=P.K;if(!Y)return TU("PES is undefined"),P.return();W.K=new BF$(Y,W.api,W.J,W.W);k=W.FR(Y);return g.m(P,l3h(Y,k,W.J,W.W,W.zJ),3)}W.G=P.K;return g.m(P,rrp(W),0)})},rrp=function(W){var Y;
return g.D(function(k){switch(k.W){case 1:if(!W.K)return TU("transferManager is undefined"),k.return();if(W.K.W){k.oi(2);break}return g.m(k,Lp(W.K),2);case 2:if(!W.zJ.U("woffle_enable_main_downloads_library")){k.oi(4);break}return g.m(k,W.w6(),4);case 4:if(!W.zJ.U("html5_offline_playback_position_sync")){k.oi(6);break}return g.m(k,W.Hf(),7);case 7:return g.m(k,W.zL(864E5),6);case 6:return g.m(k,W.refreshAllStaleEntities(43200,!0),9);case 9:return g.m(k,W.AM(),10);case 10:if(!W.zJ.U("html5_retry_downloads_for_expiration")){k.oi(11);
break}return g.m(k,W.Pc(),11);case 11:return W.L=g.XU(function(){W.refreshAllStaleEntities(43200,!0);W.AM()},9E5),g.Ce(g.Us(),function(){return W.ox()}),g.m(k,Yz(),13);
case 13:return Y=k.K,g.m(k,SUj(Y),14);case 14:O_B(W.J),g.G1(k)}})},zVc=function(){var W,Y,k,P,T,I;
return g.D(function(X){switch(X.W){case 1:return g.m(X,Yz(),2);case 2:W=X.K;if(!W)return X.return([]);Y=Date.now()/1E3;return g.m(X,Wx(W,"offlineVideoPolicy"),3);case 3:k=X.K,P=g.p(k),T=P.next();case 4:if(T.done){X.oi(6);break}I=T.value;if(!(I.expirationTimestamp&&Number(I.expirationTimestamp)<Y)){X.oi(5);break}I.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";I.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.m(X,N1(W,I,"offlineVideoPolicy"),5);
case 5:T=P.next();X.oi(4);break;case 6:return X.return(k.map(function(h){return h.key}))}})},xz=function(W,Y,k,P,T){var I,X,h;
return g.D(function(B){if(B.W==1)return g.m(B,Yz(),2);I=B.K;if(!I)return B.return([]);X=Y.map(function(O){var u=g.xS(O,k);u={actionType:P,entityKey:u,actionMetadata:Object.assign({},KYQ(),T)};P!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(u.actionMetadata.priority=0);O=new R$(k,O,u);return np(O)});
h=d$1(I,X);BOB(W.J);return B.return(h)})},dCj=function(W,Y,k,P){var T,I,X,h,B,O,u,Z;
return g.D(function(M){switch(M.W){case 1:T=[],I=g.p(Y),X=I.next();case 2:if(X.done){M.oi(4);break}h=X.value;if(h.upToDate||k&&!h.shouldAutoSyncMetadata||!h.playlistId){M.oi(3);break}B={};switch(P){case "mainPlaylistEntity":O={nextAutoRefreshIntervalSeconds:h.checkInSeconds,autoSync:k};B={mainPlaylistEntityActionMetadata:O};break;case "musicPlaylist":u={autoSync:k},B={musicPlaylistEntityActionMetadata:u}}return g.m(M,xz(W,[h.playlistId],P,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B),6);case 6:(Z=
M.K)&&T.push.apply(T,g.ZX(Z));case 3:X=I.next();M.oi(2);break;case 4:return M.return(T)}})},mCc=function(W,Y){var k;
return g.D(function(P){return Y.length?(k=KYQ(),g.Ah(k,wC,{isEnqueuedForExpiredStreamUrlRefetch:!0}),W.api.y5("qrd",{v:Y.length}),P.return(xz(W,Y,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k))):P.return([])})},DCz=function(W,Y,k){this.W=W;
this.zJ=Y;this.J=k},wDc=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A;
return g.D(function(F){switch(F.W){case 1:return k=Bx(Y),P=g.cg(Y.entityKey),T=P.entityId,I=[],g.KC(F,2),g.m(F,gK$(W,T),4);case 4:I=F.K;if(!(W.zJ.U("woffle_enable_main_downloads_library")&&((X=I)==null?0:X.length))){F.oi(5);break}return g.m(F,Q2N(W.W,[Y.entityKey]),5);case 5:g.s2(F,3);break;case 2:return h=g.Aq(F),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.Iy&&h.type==="QUOTA_EXCEEDED"?(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):TU("Playlist add error"),F.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,B,O));case 3:u=[];if(!W.zJ.U("html5_offline_prevent_redownload_downloaded_video")){F.oi(7);break}return g.m(F,pHB(W.W,"mainVideoEntity",I),8);case 8:I=F.K;case 7:if((Z=I)==null?0:Z.length)for(M=g.p(I),t=M.next();!t.done;t=M.next())if(q=t.value,G=q.offlineVideoData,J=void 0,(J=G)==null?0:J.videoId)d=void 0,A=Number(((d=Y.actionMetadata)==null?void 0:d.priority)||
0)+1,u.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G.videoId,"mainVideoEntity",A,fp,Fyz(Y,G,T)));return F.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,u))}})},yrz=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5,z1,cd,ad,Mc,Ij,mV,jV,wB,L$,Iq,z,vk,m1,k5,EK,K,Y5,Jm,XZ,ew,U2,Yh,$$,CT,E,n,r,w,C,nC,x,a,Q,q6,Hp,jz,Sw,lF,Jq,WL,K$,Qi,rv,nX,dv,Dc,JN;
return g.D(function(XD){switch(XD.W){case 1:return k=Bx(Y),P=Y.entityKey,T=g.cg(P).entityId,I=[],X=!1,T==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.m(XD,Wx(W.W,"mainPlaylistEntity"),5)):g.m(XD,aU(W.W,P,"mainPlaylistEntity"),4);case 4:(h=XD.K)&&I.push(h);XD.oi(3);break;case 5:I=XD.K;case 3:if((B=I)==null||!B.length)return XD.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));O=g.U(Y.actionMetadata,QhK);Z=(u=O)==null?void 0:u.nextAutoRefreshIntervalSeconds;t=(M=O)==null?void 0:M.autoSync;q=[];J=G=
!0;d=!1;if(!X&&t===!1){XD.oi(6);break}g.KC(XD,7);return g.m(XD,NOh(0,!!t,!0,I),9);case 9:q=XD.K;g.s2(XD,8);break;case 7:A=g.Aq(XD);if(!(A instanceof Error&&A.message==="No data")){A instanceof Error&&A.message==="Empty response body"&&TU(A.message);XD.oi(8);break}return T==="!*$_ALL_ENTITIES_!*$"?g.m(XD,da$(W.W,Y,W.J,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.m(XD,APh(T,W.W,Y,W.J),8);case 8:if(!q.length||!X&&q[0].playlistId!==T)return XD.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k));case 6:if(X){F=[];y=g.p(q);for(L=y.next();!L.done;L=y.next())V=L.value,V.upToDate||t&&!V.shouldAutoSyncMetadata||!V.playlistId||(c={nextAutoRefreshIntervalSeconds:V.checkInSeconds,autoSync:t},F.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",V.playlistId,"mainPlaylistEntity",0,fp,{mainPlaylistEntityActionMetadata:c})));return XD.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,F))}q.length&&(X7=q[0],d=!!X7.upToDate,t&&(G=(Id=X7.shouldAutoSyncMetadata)!=null?Id:!0,J=(Sz=X7.shouldAutoSyncVideos)!=
null?Sz:!0,X7.checkInSeconds&&(Z=X7.checkInSeconds)));if(d||!G)return XD.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));O2=[];$5=I[0];if(!$5.downloadState){z1=void 0;XD.oi(15);break}return g.m(XD,aU(W.W,$5.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:z1=XD.K;case 15:return cd=z1,Mc=((ad=cd)==null?0:ad.addedTimestampMillis)?String(cd.addedTimestampMillis):void 0,g.KC(XD,17),g.m(XD,gK$(W,T,Mc,Z),19);case 19:O2=XD.K;g.s2(XD,18);break;case 17:Ij=g.Aq(XD);if(!(Ij instanceof
Error&&Ij.message==="No data for playlist")){if(Ij instanceof Error&&Ij.message==="Empty response body for playlist")TU(Ij.message);else return mV="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jV="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ij instanceof g.Iy&&Ij.type==="QUOTA_EXCEEDED"&&(mV="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jV="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),XD.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,mV,jV));
XD.oi(18);break}return g.m(XD,APh(T,W.W,Y,W.J),18);case 18:if(!J)return XD.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));wB=[];L$=new Map;if((Iq=O2)==null?0:Iq.length)for(z=g.p(O2),vk=z.next();!vk.done;vk=z.next())m1=vk.value,k5=m1.offlineVideoData,EK=void 0,((EK=k5)==null?0:EK.videoId)&&L$.set(k5.videoId,k5);K=new Map;Y5=[];if((Jm=$5)==null?0:(XZ=Jm.videos)==null?0:XZ.length)for(ew=g.p($5.videos),U2=ew.next();!U2.done;U2=ew.next())if(Yh=U2.value,$$=JSON.parse(g.cg(Yh).entityId),
CT=$$.videoId)L$.has(CT)?(K.set(CT,L$.get(CT)),L$.delete(CT)):Y5.push(CT);n=Number(((E=Y.actionMetadata)==null?void 0:E.priority)||0)+1;r=g.p(L$.entries());for(w=r.next();!w.done;w=r.next())C=w.value,nC=g.p(C),x=nC.next().value,a=nC.next().value,Q=x,q6=a,wB.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Q,"mainVideoEntity",n,fp,Fyz(Y,q6,T)));Hp=g.p(K.entries());for(jz=Hp.next();!jz.done;jz=Hp.next())Sw=jz.value,lF=g.p(Sw),Jq=lF.next().value,WL=lF.next().value,K$=Jq,Qi=WL,wB.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
K$,"mainVideoEntity",n,fp,Fyz(Y,Qi,T)));rv=g.p(Y5);for(nX=rv.next();!nX.done;nX=rv.next())dv=nX.value,Dc={playlistId:T},JN={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Dc},wB.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",dv,"mainVideoEntity",0,fp,JN));return XD.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,wB))}})},eVw=function(W,Y){var k,P,T,I;
return g.D(function(X){switch(X.W){case 1:return k=Bx(Y),g.KC(X,2),P=g.cg(Y.entityKey).entityId,P==="!*$_ALL_ENTITIES_!*$"?g.m(X,da$(W.W,Y,W.J,(T=Y.actionMetadata)==null?void 0:(I=T.offlineLoggingData)==null?void 0:I.offlineDeleteReason),5):g.m(X,APh(P,W.W,Y,W.J),6);case 6:if(!W.zJ.U("woffle_enable_main_downloads_library")){X.oi(5);break}return g.m(X,yPi(W.W,Y.entityKey),5);case 5:g.s2(X,3);break;case 2:return g.Aq(X),X.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k))}})},gK$=function(W,Y,k,P){var T,I,X,h,B,O,u;
return g.D(function(Z){switch(Z.W){case 1:return g.m(Z,fxz([Y]),2);case 2:return T=Z.K,g.m(Z,oKc(W,T[0],k,P),3);case 3:return I=Z.K,X=I.mainPlaylistEntity,h=I.JCr,O=s2K(X,(B=h)==null?void 0:B.avatar),g.KC(Z,4),g.m(Z,GU(O),6);case 6:g.s2(Z,5);break;case 4:u=g.Aq(Z),u instanceof Error&&u.message==="Failed to fetch"&&TU(u.message);case 5:return Z.return(T[0].videos)}})},oKc=function(W,Y,k,P){var T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y;
return g.D(function(L){switch(L.W){case 1:T=Date.now().toString();k||(k=T);I=Y.videos;X=Y.playlistId;h=[];B=[];if(I)for(O=g.p(I),u=O.next();!u.done;u=O.next()){Z=u.value;M=Z.offlineVideoData;if(!M||!M.videoId)throw TU("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");t=M.videoId;q={videoId:t,playlistId:X};G={id:g.xS(JSON.stringify(q),"mainPlaylistVideoEntity"),video:g.xS(t,"mainVideoEntity")};h.push(G);B.push(G.id)}d={key:g.xS(X,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:k,lastSyncedTimestampMillis:T};A={key:g.xS(X,"mainPlaylistEntity"),playlistId:X,videos:B,title:Y.title,thumbnailStyleData:vKK(Y),visibility:CGK(Y),downloadState:d.key};Y.channel&&(F=Y.channel.offlineChannelData,J=LyN(g.xS(X,"ytMainChannelEntity"),F),A.channelOwner=J.id);((y=A)==null?0:y.entityMetadata)?(A.entityMetadata.offlineLastModifiedTimestampSeconds=Y.lastModifiedTimestamp,P&&(A.entityMetadata.nextAutoRefreshIntervalSeconds=String(P))):A&&(A.entityMetadata={nextAutoRefreshIntervalSeconds:P?
String(P):void 0,offlineLastModifiedTimestampSeconds:Y.lastModifiedTimestamp});g.KC(L,2);return g.m(L,VE(W.W,{mode:"readwrite",sR:!0},function(V){var c=bc(V,A,"mainPlaylistEntity"),X7=bc(V,d,"mainPlaylistDownloadStateEntity");c=[c,X7];X7=g.p(h);for(var Id=X7.next();!Id.done;Id=X7.next())c.push(bc(V,Id.value,"mainPlaylistVideoEntity"));J&&c.push(bc(V,J,"ytMainChannelEntity"));return g.ZS.all(c)}),4);
case 4:g.s2(L,3);break;case 2:throw g.Aq(L),TU("PES failure for playlist"),Error("PES failure for playlist");case 3:return L.return({mainPlaylistEntity:A,JCr:J,uLa:h})}})},LyN=function(W,Y){return{id:W,
channelId:Y.channelId,title:Y.title,avatar:Y.thumbnail}},vKK=function(W){var Y=[],k=W.videos;
k&&k.length>0&&Y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:k[0].offlineVideoData.thumbnail}}});if((W=W.additionalMetadadatas)&&W.length>0)for(W=g.p(W),k=W.next();!k.done;k=W.next()){var P=k.value.offlineBundleItemPlaylistData,T=void 0;k=(T=P)==null?void 0:T.style;T=void 0;P={collageThumbnail:{coverThumbnail:(T=P)==null?void 0:T.coverThumbnail}};switch(k){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":Y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:P});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":Y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:P});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":Y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:P});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":Y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:P})}}return Y},CGK=function(W){switch(W.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},Fyz=function(W,Y,k){Y={offlineVideoData:Y,
playlistId:k};if(W=g.U(W.actionMetadata,QhK))Y.maximumDownloadQuality=W.maximumDownloadQuality;return{mainVideoEntityActionMetadata:Y}},UC$=function(W,Y,k){this.W=W;
this.zJ=Y;this.J=k},crz=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q;
return g.D(function(G){switch(G.W){case 1:return k=Bx(Y),P=g.cg(Y.entityKey),T=P.entityId,I=g.U(Y.actionMetadata,Vd),h=!((X=I)==null?0:X.playlistId),g.KC(G,2),g.m(G,lEK(W,T,void 0,(B=I)==null?void 0:B.offlineVideoData,h),4);case 4:g.s2(G,3);break;case 2:return O=g.Aq(G),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.Iy&&O.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
G.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,u,Z));case 3:M=1;M=Number(((t=Y.actionMetadata)==null?void 0:t.priority)||0)+1;var J=(J=g.U(Y.actionMetadata,Vd))?{playbackDataActionMetadata:{maximumDownloadQuality:J.maximumDownloadQuality}}:void 0;q=gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T,"playbackData",M,bIw,J);return G.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,[q]))}})},xCQ=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A;
return g.D(function(F){switch(F.W){case 1:return k=Bx(Y),P=g.cg(Y.entityKey),T=P.entityId,g.m(F,aU(W.W,Y.entityKey,"mainVideoEntity"),2);case 2:I=F.K;if(!I){X=void 0;F.oi(3);break}return g.m(F,aU(W.W,I.downloadState,"mainVideoDownloadStateEntity"),4);case 4:X=F.K;case 3:h=X;if(!I||!h)return F.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));g.KC(F,5);return g.m(F,lEK(W,T,h.addedTimestampMillis,(O=g.U(Y.actionMetadata,Vd))==null?void 0:O.offlineVideoData),7);case 7:u=1;u=Number(((Z=
Y.actionMetadata)==null?void 0:Z.priority)||0)+1;B=gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",T,"playbackData",u,bIw);g.s2(F,6);break;case 5:M=g.Aq(F);if(!(M instanceof Error&&M.message==="No data")){if(M instanceof Error&&M.message==="Empty response body")TU(M.message);else return t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.Iy&&M.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),F.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,t,q));F.oi(6);break}return g.m(F,Js(W.W,T),9);case 9:G=F.K;J=g.U(Y.actionMetadata,Vd);if(A=(d=J)==null?void 0:d.playlistId)G.playlistId=A;G.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.m(F,Kp(T,W.W,Y,W.J,G),6);case 6:return F.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,B?[B]:void 0))}})},fE1=function(W,Y){var k,P,T,I,X,h,B,O,u,Z;
return g.D(function(M){switch(M.W){case 1:return k=Bx(Y),g.KC(M,2),P=g.cg(Y.entityKey).entityId,P==="!*$_ALL_ENTITIES_!*$"?g.m(M,da$(W.W,Y,W.J,(u=Y.actionMetadata)==null?void 0:(Z=u.offlineLoggingData)==null?void 0:Z.offlineDeleteReason),5):g.m(M,Js(W.W,P),6);case 6:T=M.K;I=g.U(Y.actionMetadata,Vd);if(h=(X=I)==null?void 0:X.playlistId)T.playlistId=h;T.offlineDeleteReason=(B=Y.actionMetadata)==null?void 0:(O=B.offlineLoggingData)==null?void 0:O.offlineDeleteReason;return g.m(M,Kp(P,W.W,Y,W.J,T),7);
case 7:if(!W.zJ.U("woffle_enable_main_downloads_library")){M.oi(5);break}return g.m(M,yPi(W.W,Y.entityKey),5);case 5:g.s2(M,3);break;case 2:return g.Aq(M),M.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k))}})},lEK=function(W,Y,k,P,T){var I,X,h,B,O,u;
return g.D(function(Z){switch(Z.W){case 1:if(I=P){Z.oi(2);break}return g.m(Z,xaN([Y]),3);case 3:X=Z.K,I=X[0];case 2:return g.m(Z,VMQ(W,I,k,T),4);case 4:h=Z.K;B=h.mainVideoEntity;O=h.channelEntity;g.KC(Z,5);var M=qM(B.thumbnail),t=qM(O.avatar);return g.m(Z,GU(M.concat(t)),7);case 7:g.s2(Z,0);break;case 5:u=g.Aq(Z),u instanceof Error&&u.message==="Failed to fetch"&&TU(u.message),g.G1(Z)}})},VMQ=function(W,Y,k,P){var T,I,X,h,B,O,u,Z,M,t,q,G,J;
return g.D(function(d){switch(d.W){case 1:k||(k=Date.now().toString());I=(T=Y.channel)==null?void 0:T.offlineChannelData;X={id:g.xS(Y.videoId,"ytMainChannelEntity"),channelId:I.channelId,title:I.title,avatar:I.thumbnail};h={key:g.xS(Y.videoId,"mainVideoDownloadStateEntity"),playbackData:g.xS(Y.videoId,"playbackData"),addedTimestampMillis:k,videoDownloadContextEntity:g.xS(Y.videoId,"videoDownloadContextEntity")};B={key:g.xS(Y.videoId,"videoPlaybackPositionEntity"),videoId:Y.videoId,lastPlaybackPositionSeconds:"0"};
W.zJ.U("html5_offline_playback_position_sync")&&(O={playbackPosition:B.key});u=g.xS(Y.videoId,"mainVideoEntity");Z={key:u,videoId:Y.videoId,title:Y.title,thumbnail:Y.thumbnail,localizedStrings:{viewCount:Y.shortViewCountText},userState:O,lengthSeconds:Y.lengthSeconds?Number(Y.lengthSeconds):void 0,publishedTimestampMillis:Y.publishedTimestamp?(Number(Y.publishedTimestamp)*1E3).toString():void 0,formattedDescription:Y.description,owner:X.id,downloadState:h.key};if(!W.zJ.U("woffle_enable_main_downloads_library")||
!P){d.oi(2);break}return g.m(d,wHj(W.W,[u]),3);case 3:if(q=d.K)M=q.mainDownloadsLibraryEntity,t=q.mainDownloadsListEntity;case 2:return J=nAQ,G={key:g.xS(Y.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Ah(h,J,G),g.m(d,VE(W.W,{mode:"readwrite",sR:!0},function(A){var F=bc(A,X,"ytMainChannelEntity"),y=bc(A,h,"mainVideoDownloadStateEntity"),L=bc(A,Z,"mainVideoEntity");F=[F,y,L];W.zJ.U("html5_offline_playback_position_sync")&&(y=bc(A,B,"videoPlaybackPositionEntity"),
F.push(y));M&&(y=bc(A,M,"mainDownloadsLibraryEntity"),F.push(y));t&&(y=bc(A,t,"mainDownloadsListEntity"),F.push(y));G&&(A=bc(A,G,"downloadStatusEntity"),F.push(A));return g.ZS.all(F)}),4);
case 4:return d.return({mainVideoEntity:Z,channelEntity:X})}})},NFw=function(W,Y,k){this.W=W;
this.zJ=Y;this.J=k},Wf1=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5;
return g.D(function(z1){switch(z1.W){case 1:return k=Bx(Y),P=[],g.m(z1,oU.getInstance(),2);case 2:T=z1.K;if(!T){z1.oi(3);break}return g.m(z1,T.get("sdois"),4);case 4:return I=z1.K,g.m(z1,(h=T)==null?void 0:h.get("lmqf"),5);case 5:X=z1.K;case 3:g.KC(z1,6);if(I===void 0)throw Error("prefStorage or opt-in state is undefined");B=[];if(I){z1.oi(8);break}return g.m(z1,FYj(W.W),9);case 9:B=z1.K,B.reverse();case 8:if(!B.length){z1.oi(10);break}O=g.p(B);u=O.next();case 11:if(u.done){z1.oi(10);break}Z=u.value;
if(!Z){z1.oi(12);break}M=g.cg(Z).entityId;return g.m(z1,Js(W.W,M),14);case 14:return t=z1.K,t.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.m(z1,Kp(M,W.W,{entityKey:Z,actionType:Y.actionType},W.J,t),12);case 12:u=O.next();z1.oi(11);break;case 10:return g.m(z1,WH1(I,(q=X)!=null?q:"SD"),16);case 16:return G=z1.K,g.m(z1,maw(G),17);case 17:J=gAc(G);if(!W.zJ.U("woffle_enable_main_downloads_library")){z1.oi(18);break}if(I){z1.oi(19);break}return g.m(z1,yPi(W.W,g.eF),19);case 19:return g.m(z1,
Q2N(W.W,[g.eF]),18);case 18:if((d=J)==null?0:d.length)for(A=g.p(J),F=A.next();!F.done;F=A.next())if(L=y=F.value,V=L.actionType,c=L.entityKey,X7=L.actionMetadata,V&&c&&X7&&!g.U(X7,aEK)){V==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(X7.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Id=g.U(y.actionMetadata,Vd))Id.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",y.actionMetadata=Object.assign({},y.actionMetadata,{mainVideoEntityActionMetadata:Id});P.push(y)}g.s2(z1,
7);break;case 6:return Sz=g.Aq(z1),O2="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",$5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Sz instanceof g.Iy&&Sz.type==="QUOTA_EXCEEDED"&&(O2="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",$5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),z1.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,O2,$5));case 7:return z1.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,P))}})},Yii=function(){cx.apply(this,
arguments);
this.N="mainVideoEntity"},$Kh=function(W,Y,k){Y=Y===void 0?43200:Y;
k=k===void 0?!0:k;var P=P===void 0?!1:P;var T,I,X;return g.D(function(h){switch(h.W){case 1:if(!W.X.s6())return h.return([]);T=[];g.KC(h,2);return g.m(h,NOh(Y,k,P),4);case 4:T=h.K;g.s2(h,3);break;case 2:I=g.Aq(h),I instanceof Error&&I.message==="No data"||I instanceof Error&&I.message==="Empty response body"&&TU(I.message);case 3:return X=dCj(W,T,k,"mainPlaylistEntity"),h.return(X)}})},k5p=function(W,Y,k,P){P=P===void 0?!1:P;
var T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A;return g.D(function(F){switch(F.W){case 1:return T=[],g.m(F,axi(),2);case 2:return(I=F.K)||P?g.m(F,YrB(Y,k),3):F.return([]);case 3:X=F.K;if((h=X)==null||!h.length)return F.return([]);B={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};O=g.p(X);u=O.next();case 4:if(u.done){F.oi(6);break}M=Z=u.value;t=M.actionType;q=M.entityKey;G=M.actionMetadata;if(!(t&&q&&G)||g.U(G,aEK)){F.oi(5);break}t==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(G.offlineLoggingData=
B);J=g.cg(q);d=J.entityId;return g.m(F,xz(W,[d],"mainVideoEntity",t,G),8);case 8:A=F.K,T=T.concat(A);case 5:u=O.next();F.oi(4);break;case 6:return F.return(T)}})},PwQ=function(W,Y){this.W=W;
this.J=Y},jiw=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d;
return g.D(function(A){switch(A.W){case 1:return k=Bx(Y),P=g.cg(Y.entityKey),T=P.entityId,I=[],g.KC(A,2),g.m(A,Tnc(W,T),4);case 4:I=A.K;if((X=I)==null||!X.length){A.oi(5);break}return g.m(A,LYh(W.W,Y.entityKey),5);case 5:g.s2(A,3);break;case 2:return h=g.Aq(A),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.Iy&&h.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
A.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,B,O));case 3:return u=[],g.m(A,pHB(W.W,"musicTrack",I),7);case 7:I=A.K;if(I.length)for(Z=g.p(I),M=Z.next();!M.done;M=Z.next())if(t=M.value,q=t.offlineVideoData,G=void 0,(G=q)==null?0:G.videoId)J=void 0,d=Number(((J=Y.actionMetadata)==null?void 0:J.priority)||0)+1,u.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q.videoId,"musicTrack",d,NM,zU(Y,q,T)));return A.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,u))}})},
IJw=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5,z1,cd,ad,Mc,Ij,mV,jV,wB,L$,Iq,z,vk,m1,k5,EK,K,Y5,Jm,XZ,ew,U2,Yh,$$,CT,E,n,r,w,C,nC,x,a;
return g.D(function(Q){switch(Q.W){case 1:return k=Bx(Y),P=Y.entityKey,T=g.cg(P).entityId,I=[],X=!1,T==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.m(Q,Wx(W.W,"musicAlbumRelease"),5)):g.m(Q,aU(W.W,P,"musicAlbumRelease"),4);case 4:(h=Q.K)&&I.push(h);Q.oi(3);break;case 5:I=Q.K;case 3:if((B=I)==null||!B.length)return Q.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));if(X){O=[];u=g.p(I);for(Z=u.next();!Z.done;Z=u.next())M=Z.value,t=g.cg(M.id).entityId,O.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
t,"musicAlbumRelease",0,NM));return Q.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,O))}q=[];G=I[0];J=void 0;if(!G.downloadMetadata){Q.oi(6);break}return g.m(Q,aU(W.W,G.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:d=Q.K,J=Number((F=(A=d)==null?void 0:A.addedTimestampMillis)!=null?F:"0")/1E3;case 6:return g.KC(Q,8),g.m(Q,Tnc(W,T,(y=J)==null?void 0:y.toString()),10);case 10:q=Q.K;g.s2(Q,9);break;case 8:L=g.Aq(Q);if(!(L instanceof Error&&L.message==="No data")){if(L instanceof
Error&&L.message==="Empty response body")TU(L.message);else return V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.Iy&&L.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Q.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,V,c));Q.oi(9);break}return g.m(Q,rC(T,"musicAlbumRelease",W.W,Y,W.J),9);case 9:X7=[];Id=new Map;
if((Sz=q)==null?0:Sz.length)for(O2=g.p(q),$5=O2.next();!$5.done;$5=O2.next())z1=$5.value,cd=z1.offlineVideoData,ad=void 0,((ad=cd)==null?0:ad.videoId)&&Id.set(cd.videoId,cd);Mc=new Map;Ij=[];if((mV=G)==null?0:(jV=mV.tracks)==null?0:jV.length)for(wB=g.p(G.tracks),L$=wB.next();!L$.done;L$=wB.next())if(Iq=L$.value,z=g.cg(Iq).entityId)Id.has(z)?(Mc.set(z,Id.get(z)),Id.delete(z)):Ij.push(z);m1=Number(((vk=Y.actionMetadata)==null?void 0:vk.priority)||0)+1;k5=g.p(Id.entries());for(EK=k5.next();!EK.done;EK=
k5.next())K=EK.value,Y5=g.p(K),Jm=Y5.next().value,XZ=Y5.next().value,ew=Jm,U2=XZ,X7.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",ew,"musicTrack",m1,NM,zU(Y,U2)));Yh=g.p(Mc.entries());for($$=Yh.next();!$$.done;$$=Yh.next())CT=$$.value,E=g.p(CT),n=E.next().value,r=E.next().value,w=n,C=r,X7.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",w,"musicTrack",m1,NM,zU(Y,C)));nC=g.p(Ij);for(x=nC.next();!x.done;x=nC.next())a=x.value,X7.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",a,"musicTrack",
0,NM));return Q.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,X7))}})},Xyw=function(W,Y){var k,P;
return g.D(function(T){switch(T.W){case 1:return k=Bx(Y),g.KC(T,2),P=g.cg(Y.entityKey).entityId,P==="!*$_ALL_ENTITIES_!*$"?g.m(T,As(W.W,Y,W.J),5):g.m(T,rC(P,"musicAlbumRelease",W.W,Y,W.J),6);case 6:return g.m(T,Uaz(W.W,Y.entityKey),5);case 5:g.s2(T,3);break;case 2:return g.Aq(T),T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},Tnc=function(W,Y,k){var P,T,I;
return g.D(function(X){switch(X.W){case 1:return g.m(X,fxz([Y]),2);case 2:return P=X.K,g.m(X,Siz(W,P[0],k),3);case 3:return T=X.K,I=qM(T.thumbnailDetails),g.m(X,GU(I),4);case 4:return X.return(P[0].videos)}})},Siz=function(W,Y,k){var P,T,I,X,h,B,O,u,Z,M,t,q,G,J;
return g.D(function(d){if(d.W==1){P=Y.additionalMetadadatas;T=void 0;if(P&&P.length>0)for(I=g.p(P),X=I.next();!X.done;X=I.next())if(h=X.value,h.offlineMusicPlaylistData){T=h.offlineMusicPlaylistData;break}B=Y.playlistId;O=lxi(Y);u=O.Tl;Z=O.J1;M=k?(Number(k)*1E3).toString():Date.now().toString();t=Y.lastModifiedTimestamp?(Number(Y.lastModifiedTimestamp)*1E3).toString():"0";q={id:g.xS(B,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:Z,lastModifiedTimestampMillis:t,addedTimestampMillis:M,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};G={id:g.xS(B,"musicAlbumRelease"),title:Y.title,audioPlaylistId:B,trackCount:Y.totalVideoCount,tracks:u,downloadMetadata:q.id};T&&(G.thumbnailDetails=(J=T.albumHqThumbnail)!=null?J:T.albumArtistThumbnail,G.artistDisplayName=T.albumArtistDisplayName,G.releaseDate=T.albumReleaseDate,G.contentRating={explicitType:T.albumReleaseExplicitType},G.releaseType=T.albumReleaseType);return g.m(d,VE(W.W,{mode:"readwrite",sR:!0},function(A){var F=bc(A,G,"musicAlbumRelease");
A=bc(A,q,"musicAlbumReleaseDownloadMetadataEntity");return g.ZS.all([F,A])}),2)}return d.return(G)})},hE1=function(W,Y){this.W=W;
this.J=Y},ONw=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d;
return g.D(function(A){switch(A.W){case 1:return k=Bx(Y),P=g.cg(Y.entityKey),T=P.entityId,I=[],g.KC(A,2),g.m(A,Bnh(W,T),4);case 4:I=A.K;if((X=I)==null||!X.length){A.oi(5);break}return g.m(A,LYh(W.W,Y.entityKey),5);case 5:g.s2(A,3);break;case 2:return h=g.Aq(A),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.Iy&&h.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
A.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,B,O));case 3:return u=[],g.m(A,pHB(W.W,"musicTrack",I),7);case 7:I=A.K;if(I.length)for(Z=g.p(I),M=Z.next();!M.done;M=Z.next())if(t=M.value,q=t.offlineVideoData,G=void 0,(G=q)==null?0:G.videoId)J=void 0,d=Number(((J=Y.actionMetadata)==null?void 0:J.priority)||0)+1,u.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q.videoId,"musicTrack",d,a$,zU(Y,q,T)));return A.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,u))}})},
uUc=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5,z1,cd,ad,Mc,Ij,mV,jV,wB,L$,Iq,z,vk,m1,k5,EK,K,Y5,Jm,XZ,ew,U2,Yh,$$,CT,E,n,r,w,C,nC,x,a,Q,q6,Hp,jz,Sw,lF,Jq,WL,K$,Qi,rv,nX;
return g.D(function(dv){switch(dv.W){case 1:return k=Bx(Y),P=Y.entityKey,T=g.cg(P).entityId,I=[],X=!1,T==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.m(dv,Wx(W.W,"musicPlaylist"),5)):g.m(dv,aU(W.W,P,"musicPlaylist"),4);case 4:(h=dv.K)&&I.push(h);dv.oi(3);break;case 5:I=dv.K;case 3:if((B=I)==null||!B.length)return dv.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));O=g.U(Y.actionMetadata,b_j);Z=(u=O)==null?void 0:u.autoSync;M=[];q=t=!0;G=!1;J=void 0;if(!X&&Z===!1){dv.oi(6);break}g.KC(dv,7);return g.m(dv,
$9i(0,!!Z,!0,I),9);case 9:M=dv.K;g.s2(dv,8);break;case 7:d=g.Aq(dv);if(!(d instanceof Error&&d.message==="No data")){d instanceof Error&&d.message==="Empty response body"&&TU(d.message);dv.oi(8);break}return T==="!*$_ALL_ENTITIES_!*$"?g.m(dv,As(W.W,Y,W.J),8):g.m(dv,rC(T,"musicPlaylist",W.W,Y,W.J),8);case 8:if(!M.length||!X&&M[0].playlistId!==T)return dv.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));case 6:if(X){A=[];F=g.p(M);for(y=F.next();!y.done;y=F.next())L=y.value,L.upToDate||
Z&&!L.shouldAutoSyncMetadata||!L.playlistId||(V={autoSync:Z},A.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",L.playlistId,"musicPlaylist",0,a$,{musicPlaylistEntityActionMetadata:V})));return dv.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,A))}M.length&&(c=M[0],G=!!c.upToDate,Z&&(t=(X7=c.shouldAutoSyncMetadata)!=null?X7:!0,q=(Id=c.shouldAutoSyncVideos)!=null?Id:!0,c.checkInSeconds&&(J=c.checkInSeconds)));if(G||!t)return dv.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k));Sz=[];O2=I[0];$5=void 0;if(!O2.downloadMetadata){dv.oi(15);break}return g.m(dv,aU(W.W,O2.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:z1=dv.K,$5=Number((ad=(cd=z1)==null?void 0:cd.addedTimestampMillis)!=null?ad:"0")/1E3;case 15:return g.KC(dv,17),g.m(dv,Bnh(W,T,(Mc=$5)==null?void 0:Mc.toString(),J),19);case 19:Sz=dv.K;g.s2(dv,18);break;case 17:Ij=g.Aq(dv);if(!(Ij instanceof Error&&Ij.message==="No data")){if(Ij instanceof Error&&Ij.message==="Empty response body")TU(Ij.message);
else return mV="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jV="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ij instanceof g.Iy&&Ij.type==="QUOTA_EXCEEDED"&&(mV="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jV="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),dv.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,mV,jV));dv.oi(18);break}return g.m(dv,rC(T,"musicPlaylist",W.W,Y,W.J),18);case 18:if(!q)return dv.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k));wB=[];L$=new Map;if((Iq=Sz)==null?0:Iq.length)for(z=g.p(Sz),vk=z.next();!vk.done;vk=z.next())m1=vk.value,k5=m1.offlineVideoData,EK=void 0,((EK=k5)==null?0:EK.videoId)&&L$.set(k5.videoId,k5);K=new Map;Y5=[];if((Jm=O2)==null?0:(XZ=Jm.tracks)==null?0:XZ.length)for(ew=g.p(O2.tracks),U2=ew.next();!U2.done;U2=ew.next())if(Yh=U2.value,$$=g.cg(Yh).entityId)L$.has($$)?(K.set($$,L$.get($$)),L$.delete($$)):Y5.push($$);E=Number(((CT=Y.actionMetadata)==null?void 0:CT.priority)||0)+1;n=g.p(L$.entries());for(r=
n.next();!r.done;r=n.next())w=r.value,C=g.p(w),nC=C.next().value,x=C.next().value,a=nC,Q=x,wB.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a,"musicTrack",E,a$,zU(Y,Q)));q6=g.p(K.entries());for(Hp=q6.next();!Hp.done;Hp=q6.next())jz=Hp.value,Sw=g.p(jz),lF=Sw.next().value,Jq=Sw.next().value,WL=lF,K$=Jq,wB.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",WL,"musicTrack",E,a$,zU(Y,K$)));Qi=g.p(Y5);for(rv=Qi.next();!rv.done;rv=Qi.next())nX=rv.value,wB.push(gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
nX,"musicTrack",0,a$));return dv.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,wB))}})},ZNw=function(W,Y){var k,P;
return g.D(function(T){switch(T.W){case 1:return k=Bx(Y),g.KC(T,2),P=g.cg(Y.entityKey).entityId,P==="!*$_ALL_ENTITIES_!*$"?g.m(T,As(W.W,Y,W.J),5):g.m(T,rC(P,"musicPlaylist",W.W,Y,W.J),6);case 6:return g.m(T,Uaz(W.W,Y.entityKey),5);case 5:g.s2(T,3);break;case 2:return g.Aq(T),T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},Bnh=function(W,Y,k,P){var T,I,X;
return g.D(function(h){switch(h.W){case 1:return g.m(h,fxz([Y]),2);case 2:return T=h.K,g.m(h,iNQ(W,T[0],k,P),3);case 3:return I=h.K,X=qM(I.thumbnailDetails),g.m(h,GU(X),4);case 4:return h.return(T[0].videos)}})},iNQ=function(W,Y,k,P){var T,I,X,h,B,O,u,Z,M;
return g.D(function(t){return t.W==1?(T=Y.playlistId,I=lxi(Y),X=I.Tl,h=I.J1,B=k?(Number(k)*1E3).toString():Date.now().toString(),O=Y.lastModifiedTimestamp?(Number(Y.lastModifiedTimestamp)*1E3).toString():"0",u={id:g.xS(T,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:h,lastModifiedTimestampMillis:O,addedTimestampMillis:B,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},Z={id:g.xS(T,"musicPlaylist"),title:Y.title,playlistId:T,thumbnailDetails:Y.thumbnail,visibility:MUc(Y),trackCount:Y.totalVideoCount,
tracks:X,downloadMetadata:u.id},P&&(((M=Z)==null?0:M.entityMetadata)?Z.entityMetadata.nextAutoRefreshIntervalSeconds=String(P):Z&&(Z.entityMetadata={nextAutoRefreshIntervalSeconds:String(P)})),g.m(t,VE(W.W,{mode:"readwrite",sR:!0},function(q){var G=bc(q,Z,"musicPlaylist");q=bc(q,u,"musicPlaylistDownloadMetadataEntity");return g.ZS.all([G,q])}),2)):t.return(Z)})},MUc=function(W){switch(W.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},tUz=function(W,Y){this.W=W;
this.J=Y},nG1=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q;
return g.D(function(G){switch(G.W){case 1:return k=Bx(Y),P=g.cg(Y.entityKey),T=P.entityId,I=g.U(Y.actionMetadata,qiQ),g.KC(G,2),g.m(G,REN(W,T,void 0,(X=I)==null?void 0:X.track,(h=I)==null?void 0:h.albumRelease),4);case 4:if((B=I)==null?0:B.playlistId){G.oi(5);break}return g.m(G,LYh(W.W,Y.entityKey),5);case 5:g.s2(G,3);break;case 2:return O=g.Aq(G),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.Iy&&O.type==="QUOTA_EXCEEDED"&&
(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),G.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,u,Z));case 3:t=Number(((M=Y.actionMetadata)==null?void 0:M.priority)||0)+1;var J=(J=g.U(Y.actionMetadata,qiQ))?{playbackDataActionMetadata:{maximumDownloadQuality:J.maximumDownloadQuality}}:void 0;q=gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T,"playbackData",t,HNp,J);return G.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k,[q]))}})},py$=function(W,Y){var k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J;
return g.D(function(d){switch(d.W){case 1:return k=Bx(Y),P=g.cg(Y.entityKey),T=P.entityId,g.m(d,aU(W.W,Y.entityKey,"musicTrack"),2);case 2:I=d.K;if(!I){X=void 0;d.oi(3);break}return g.m(d,aU(W.W,I.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:X=d.K;case 3:h=X;if(!I||!h)return d.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));O=g.U(Y.actionMetadata,qiQ);g.KC(d,5);return g.m(d,REN(W,T,h.addedTimestampMillis,(u=O)==null?void 0:u.track,(Z=O)==null?void 0:Z.albumRelease),
7);case 7:t=Number(((M=Y.actionMetadata)==null?void 0:M.priority)||0)+1;B=gC("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",T,"playbackData",t,HNp);g.s2(d,6);break;case 5:q=g.Aq(d);if(!(q instanceof Error&&q.message==="No data")){if(q instanceof Error&&q.message==="Empty response body")TU(q.message);else return G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.Iy&&q.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),d.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,G,J));d.oi(6);break}return g.m(d,s3(T,W.W,Y,W.J),6);case 6:return d.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,B?[B]:void 0))}})},G5z=function(W,Y){var k,P;
return g.D(function(T){switch(T.W){case 1:return k=Bx(Y),g.KC(T,2),P=g.cg(Y.entityKey).entityId,P==="!*$_ALL_ENTITIES_!*$"?g.m(T,As(W.W,Y,W.J),5):g.m(T,s3(P,W.W,Y,W.J),6);case 6:return g.m(T,Uaz(W.W,Y.entityKey),5);case 5:g.s2(T,3);break;case 2:return g.Aq(T),T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new F3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},REN=function(W,Y,k,P,T){var I,X,h,B,O,u;
return g.D(function(Z){switch(Z.W){case 1:if(I=P){Z.oi(2);break}return g.m(Z,xaN([Y]),3);case 3:X=Z.K,h=X[0],I=C9Q(h);case 2:return g.m(Z,Kf9(W,I,Y,T,k),4);case 4:B=Z.K;O=B.musicTrackEntity;u=B.X9;var M=qM(O.thumbnailDetails),t=[];u&&(t=qM(u.thumbnailDetails));return g.m(Z,GU(M.concat(t)),0)}})},Kf9=function(W,Y,k,P,T){var I;
return g.D(function(X){return X.W==1?(T||(T=Date.now().toString()),I={id:g.xS(k,"musicTrackDownloadMetadataEntity"),playbackData:g.xS(k,"playbackData"),addedTimestampMillis:T,videoDownloadContextEntity:g.xS(k,"videoDownloadContextEntity")},P&&(Y.albumRelease=P.id),g.m(X,VE(W.W,{mode:"readwrite",sR:!0},function(h){var B=[],O=bc(h,I,"musicTrackDownloadMetadataEntity");B.push(O);O=bc(h,Y,"musicTrack");B.push(O);P&&(h=bc(h,P,"musicAlbumRelease"),B.push(h));return g.ZS.all(B)}),2)):X.W!=3?g.m(X,iR(k,"musicTrackDownloadMetadataEntity",
W.W,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):X.return({musicTrackEntity:Y,
X9:P})})},WY=function(){cx.apply(this,arguments);
this.N="musicTrack"},EGj=function(W,Y,k){Y=Y===void 0?43200:Y;
k=k===void 0?!0:k;var P=P===void 0?!1:P;var T,I;return g.D(function(X){switch(X.W){case 1:if(!W.X.s6())return X.return([]);T=[];g.KC(X,2);return g.m(X,$9i(Y,k,P),4);case 4:T=X.K;g.s2(X,3);break;case 2:g.Aq(X);case 3:return I=dCj(W,T,k,"musicPlaylist"),X.return(I)}})},JB$=function(){g.JJ.apply(this,arguments);
var W=this;this.events=new g.p5(this);this.zJ=this.player.V();this.zW={M9J:function(){return W.W},
FO:function(){return W.FO()},
Ac:function(Y){return W.Ac(Y)}}},siB=function(W){var Y;
W=g.U((Y=W.getWatchNextResponse())==null?void 0:Y.currentVideoEndpoint,g.GW);if(W==null?0:W.playlistId)var k=W.playlistId;return k},rBB=function(W,Y){var k,P,T,I;
return g.D(function(X){if(X.W==1){k=Y.clientPlaybackNonce;P={cpn:k,offlineSourceVisualElement:g.O5(Y.UP||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};Y.K&&(P.videoFmt=Number(Y.K.itag));Y.T&&(P.audioFmt=Number(Y.T.itag));if((T=siB(Y))&&Y.videoId){var h=Y.videoId;h=T!=="PPSV"?Promise.resolve(!1):W.W.nD(h);X=g.m(X,h,3)}else X=X.oi(2);return X}X.W!=2&&(I=X.K)&&(P.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");W.K=k;g.W8("offlinePlaybackStarted",P);g.G1(X)})};
g.Ub.prototype.bx=g.Pd(45,function(W){return this.app.bx(W)});
g.Hz.prototype.bx=g.Pd(44,function(W){return g.QZ7(this,9,W)});
g.H(yE,QE);g.T1.Object.defineProperties(yE.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.W.entityMetadata},
set:function(W){this.W.entityMetadata=W}}});
g.H(tRK,yE);tRK.prototype.K=function(){return[]};
g.H(qui,yE);qui.prototype.K=function(){return[]};
g.H(Rgw,yE);Rgw.prototype.K=function(){return[]};
g.H(HHK,yE);HHK.prototype.K=function(){return[]};
g.H(ne1,yE);ne1.prototype.K=function(){return[]};
g.H(pIh,yE);pIh.prototype.K=function(){var W=[];this.W.alternateChannel&&W.push(this.W.alternateChannel);this.W.alternateChannelList&&W.push.apply(W,g.ZX(this.W.alternateChannelList));this.W.oneofChannelEntity&&W.push(this.W.oneofChannelEntity);return[].concat(g.ZX(new Set(W)))};
g.H(G9K,yE);G9K.prototype.K=function(){var W=[];this.W.entryCollection&&W.push(this.W.entryCollection);return[].concat(g.ZX(new Set(W)))};
g.H(K6z,QE);K6z.prototype.K=function(){var W=[];this.W.video&&W.push(this.W.video);return[].concat(g.ZX(new Set(W)))};
g.H(EeN,yE);EeN.prototype.K=function(){var W=[];this.W.parentPlaylist&&W.push(this.W.parentPlaylist);if(this.W.entries)for(var Y=g.p(this.W.entries),k=Y.next();!k.done;k=Y.next())W.push.apply(W,g.ZX((new K6z(k.value)).K()));return[].concat(g.ZX(new Set(W)))};
g.H(JWc,yE);JWc.prototype.K=function(){var W=[];this.W.descriptionEntity&&W.push(this.W.descriptionEntity);this.W.creators&&W.push.apply(W,g.ZX(this.W.creators));this.W.theBiggestFan&&W.push(this.W.theBiggestFan);return[].concat(g.ZX(new Set(W)))};
g.H(s5w,yE);s5w.prototype.K=function(){return[]};
g.H(rW1,yE);rW1.prototype.K=function(){return[]};
g.H(AWz,yE);AWz.prototype.K=function(){return[]};
g.H(zgh,yE);zgh.prototype.K=function(){return[]};
g.H(d4z,yE);d4z.prototype.K=function(){return[]};
g.H(m4p,yE);m4p.prototype.K=function(){return[]};
g.H(D4N,yE);D4N.prototype.K=function(){return[]};
g.H(gez,yE);gez.prototype.K=function(){return[]};
g.H(F6z,yE);F6z.prototype.K=function(){return[]};
g.H(wIc,yE);wIc.prototype.K=function(){var W=[];this.W.downloadsList&&W.push(this.W.downloadsList);this.W.smartDownloadsList&&W.push(this.W.smartDownloadsList);this.W.recommendedDownloadsList&&W.push(this.W.recommendedDownloadsList);this.W.refresh&&W.push(this.W.refresh);return[].concat(g.ZX(new Set(W)))};
g.H(Q5B,QE);Q5B.prototype.K=function(){var W=[];this.W.video&&W.push(this.W.video);this.W.playlist&&W.push(this.W.playlist);this.W.videoItem&&W.push(this.W.videoItem);this.W.playlistItem&&W.push(this.W.playlistItem);return[].concat(g.ZX(new Set(W)))};
g.H(yW9,yE);yW9.prototype.K=function(){var W=[];this.W.refresh&&W.push(this.W.refresh);if(this.W.downloads)for(var Y=g.p(this.W.downloads),k=Y.next();!k.done;k=Y.next())W.push.apply(W,g.ZX((new Q5B(k.value)).K()));return[].concat(g.ZX(new Set(W)))};
g.H(egc,yE);egc.prototype.K=function(){var W=[];this.W.localImageEntities&&W.push.apply(W,g.ZX(this.W.localImageEntities));return[].concat(g.ZX(new Set(W)))};
g.H(oe$,yE);oe$.prototype.K=function(){var W=[];this.W.playbackData&&W.push(this.W.playbackData);this.W.localImageEntities&&W.push.apply(W,g.ZX(this.W.localImageEntities));this.W.videoDownloadContextEntity&&W.push(this.W.videoDownloadContextEntity);return[].concat(g.ZX(new Set(W)))};
g.H(vec,yE);vec.prototype.K=function(){return[]};
g.H(Cp9,yE);Cp9.prototype.K=function(){var W=[];this.W.fakeChildren&&W.push.apply(W,g.ZX(this.W.fakeChildren));return[].concat(g.ZX(new Set(W)))};
g.H(L69,yE);L69.prototype.K=function(){var W=[];this.W.video&&W.push(this.W.video);this.W.playbackData&&W.push(this.W.playbackData);this.W.offlineVideoPolicy&&W.push(this.W.offlineVideoPolicy);return[].concat(g.ZX(new Set(W)))};
g.H(U4Q,yE);U4Q.prototype.K=function(){return[]};
g.H(lvK,yE);lvK.prototype.K=function(){var W=[];this.W.channelOwner&&W.push(this.W.channelOwner);this.W.videos&&W.push.apply(W,g.ZX(this.W.videos));this.W.collaboratorChannels&&W.push.apply(W,g.ZX(this.W.collaboratorChannels));this.W.downloadState&&W.push(this.W.downloadState);this.W.refresh&&W.push(this.W.refresh);return[].concat(g.ZX(new Set(W)))};
g.H(bHN,yE);bHN.prototype.K=function(){var W=[];this.W.video&&W.push(this.W.video);this.W.channelContributor&&W.push(this.W.channelContributor);return[].concat(g.ZX(new Set(W)))};
g.H(cWi,QE);cWi.prototype.K=function(){var W=[];this.W.localImageEntities&&W.push.apply(W,g.ZX(this.W.localImageEntities));this.W.videoDownloadContextEntity&&W.push(this.W.videoDownloadContextEntity);return[].concat(g.ZX(new Set(W)))};
g.H(x4i,QE);x4i.prototype.K=function(){var W=[];this.W.recommendedVideoMetadata&&W.push.apply(W,g.ZX((new cWi(this.W.recommendedVideoMetadata)).K()));return[].concat(g.ZX(new Set(W)))};
g.H(fvN,QE);fvN.prototype.K=function(){var W=[];this.W.playbackPosition&&W.push(this.W.playbackPosition);return[].concat(g.ZX(new Set(W)))};
g.H(VRi,yE);VRi.prototype.K=function(){var W=[];this.W.owner&&W.push(this.W.owner);this.W.downloadState&&W.push(this.W.downloadState);this.W.userState&&W.push.apply(W,g.ZX((new fvN(this.W.userState)).K()));this.W.additionalMetadata&&W.push.apply(W,g.ZX((new x4i(this.W.additionalMetadata)).K()));return[].concat(g.ZX(new Set(W)))};
g.H(NT$,yE);NT$.prototype.K=function(){var W=[];this.W.userChannelDetails&&W.push(this.W.userChannelDetails);return[].concat(g.ZX(new Set(W)))};
g.H(avp,yE);avp.prototype.K=function(){var W=[];this.W.channelOwner&&W.push(this.W.channelOwner);this.W.playbackPosition&&W.push(this.W.playbackPosition);this.W.localImageEntities&&W.push.apply(W,g.ZX(this.W.localImageEntities));this.W.downloadStatus&&W.push(this.W.downloadStatus);return[].concat(g.ZX(new Set(W)))};
g.H(WQc,yE);WQc.prototype.K=function(){return[]};
g.H(YJK,yE);YJK.prototype.K=function(){return[]};
g.H($Wc,yE);$Wc.prototype.K=function(){return[]};
g.H(kR1,yE);kR1.prototype.K=function(){return[]};
g.H(P3c,yE);P3c.prototype.K=function(){return[]};
g.H(TgN,yE);TgN.prototype.K=function(){return[]};
g.H(jx1,yE);jx1.prototype.K=function(){return[]};
g.H(I41,yE);I41.prototype.K=function(){return[]};
g.H(X9w,yE);X9w.prototype.K=function(){return[]};
g.H(SJp,yE);SJp.prototype.K=function(){return[]};
g.H(hxK,yE);hxK.prototype.K=function(){return[]};
g.H(BgB,yE);BgB.prototype.K=function(){return[]};
g.H(Ovi,yE);Ovi.prototype.K=function(){var W=[];this.W.trackDownloadMetadatas&&W.push.apply(W,g.ZX(this.W.trackDownloadMetadatas));return[].concat(g.ZX(new Set(W)))};
g.H(uA$,yE);
uA$.prototype.K=function(){var W=[];this.W.downloadedTracks&&W.push.apply(W,g.ZX(this.W.downloadedTracks));this.W.smartDownloadedTracks&&W.push.apply(W,g.ZX(this.W.smartDownloadedTracks));this.W.downloadedEpisodes&&W.push.apply(W,g.ZX(this.W.downloadedEpisodes));this.W.downloadedAlbumReleases&&W.push.apply(W,g.ZX(this.W.downloadedAlbumReleases));this.W.smartDownloadedAlbumReleases&&W.push.apply(W,g.ZX(this.W.smartDownloadedAlbumReleases));this.W.downloadedPlaylists&&W.push.apply(W,g.ZX(this.W.downloadedPlaylists));this.W.smartDownloadedPlaylists&&
W.push.apply(W,g.ZX(this.W.smartDownloadedPlaylists));this.W.metadataOnlyTracks&&W.push.apply(W,g.ZX(this.W.metadataOnlyTracks));return[].concat(g.ZX(new Set(W)))};
g.H(Zvz,yE);Zvz.prototype.K=function(){var W=[];this.W.trackDownloadMetadatas&&W.push.apply(W,g.ZX(this.W.trackDownloadMetadatas));return[].concat(g.ZX(new Set(W)))};
g.H(ivc,yE);ivc.prototype.K=function(){var W=[];this.W.playbackData&&W.push(this.W.playbackData);this.W.localImageEntities&&W.push.apply(W,g.ZX(this.W.localImageEntities));this.W.videoDownloadContextEntity&&W.push(this.W.videoDownloadContextEntity);return[].concat(g.ZX(new Set(W)))};
g.H(M21,yE);M21.prototype.K=function(){var W=[];this.W.musicLibraryStatusEntity&&W.push(this.W.musicLibraryStatusEntity);this.W.primaryArtists&&W.push.apply(W,g.ZX(this.W.primaryArtists));this.W.details&&W.push(this.W.details);this.W.userDetails&&W.push(this.W.userDetails);this.W.tracks&&W.push.apply(W,g.ZX(this.W.tracks));this.W.share&&W.push(this.W.share);this.W.downloadMetadata&&W.push(this.W.downloadMetadata);this.W.refresh&&W.push(this.W.refresh);return[].concat(g.ZX(new Set(W)))};
g.H(t2z,yE);t2z.prototype.K=function(){var W=[];this.W.albumRelease&&W.push(this.W.albumRelease);this.W.tracks&&W.push.apply(W,g.ZX(this.W.tracks));return[].concat(g.ZX(new Set(W)))};
g.H(qJh,yE);qJh.prototype.K=function(){var W=[];this.W.albumRelease&&W.push(this.W.albumRelease);return[].concat(g.ZX(new Set(W)))};
g.H(Rxi,yE);Rxi.prototype.K=function(){var W=[];this.W.details&&W.push(this.W.details);this.W.userDetails&&W.push(this.W.userDetails);return[].concat(g.ZX(new Set(W)))};
g.H(Hvc,yE);Hvc.prototype.K=function(){var W=[];this.W.parentArtist&&W.push(this.W.parentArtist);return[].concat(g.ZX(new Set(W)))};
g.H(nd9,yE);nd9.prototype.K=function(){var W=[];this.W.parentArtist&&W.push(this.W.parentArtist);return[].concat(g.ZX(new Set(W)))};
g.H(p9Q,yE);p9Q.prototype.K=function(){return[]};
g.H(GRj,yE);GRj.prototype.K=function(){return[]};
g.H(KQh,QE);KQh.prototype.K=function(){var W=[];this.W.creatorEntity&&W.push(this.W.creatorEntity);return[].concat(g.ZX(new Set(W)))};
g.H(EdN,yE);
EdN.prototype.K=function(){var W=[];this.W.tracks&&W.push.apply(W,g.ZX(this.W.tracks));this.W.refresh&&W.push(this.W.refresh);this.W.musicLibraryStatusEntity&&W.push(this.W.musicLibraryStatusEntity);this.W.details&&W.push(this.W.details);this.W.downloadMetadata&&W.push(this.W.downloadMetadata);this.W.sideloadMetadata&&W.push(this.W.sideloadMetadata);this.W.userDetails&&W.push(this.W.userDetails);this.W.entryCollection&&W.push(this.W.entryCollection);this.W.share&&W.push(this.W.share);this.W.podcastShowAdditionalMetadata&&
W.push.apply(W,g.ZX((new KQh(this.W.podcastShowAdditionalMetadata)).K()));return[].concat(g.ZX(new Set(W)))};
g.H(JU9,yE);JU9.prototype.K=function(){return[]};
g.H(sxB,yE);
sxB.prototype.K=function(){var W=[];this.W.musicLibraryStatusEntity&&W.push(this.W.musicLibraryStatusEntity);this.W.artists&&W.push.apply(W,g.ZX(this.W.artists));this.W.audioModeVersion&&W.push(this.W.audioModeVersion);this.W.videoModeVersion&&W.push(this.W.videoModeVersion);this.W.userDetails&&W.push(this.W.userDetails);this.W.details&&W.push(this.W.details);this.W.albumRelease&&W.push(this.W.albumRelease);this.W.share&&W.push(this.W.share);this.W.libraryEdit&&W.push(this.W.libraryEdit);this.W.downloadMetadata&&
W.push(this.W.downloadMetadata);this.W.playbackPosition&&W.push(this.W.playbackPosition);this.W.lyrics&&W.push(this.W.lyrics);return[].concat(g.ZX(new Set(W)))};
g.H(rUQ,yE);rUQ.prototype.K=function(){var W=[];this.W.parentTrack&&W.push(this.W.parentTrack);return[].concat(g.ZX(new Set(W)))};
g.H(AUh,yE);AUh.prototype.K=function(){var W=[];this.W.parentTrack&&W.push(this.W.parentTrack);return[].concat(g.ZX(new Set(W)))};
g.H(zx1,yE);zx1.prototype.K=function(){return[]};
g.H(dW9,yE);dW9.prototype.K=function(){return[]};
g.H(mWi,yE);mWi.prototype.K=function(){return[]};
g.H(DWK,yE);DWK.prototype.K=function(){return[]};
g.H(gd$,yE);gd$.prototype.K=function(){var W=[];this.W.transfer&&W.push(this.W.transfer);this.W.adsPlaybackData&&W.push.apply(W,g.ZX(this.W.adsPlaybackData));this.W.drmLicense&&W.push(this.W.drmLicense);this.W.offlineVideoPolicy&&W.push(this.W.offlineVideoPolicy);this.W.videoDownloadContextEntity&&W.push(this.W.videoDownloadContextEntity);return[].concat(g.ZX(new Set(W)))};
g.H(FQK,yE);FQK.prototype.K=function(){return[]};
g.H(w9i,yE);w9i.prototype.K=function(){var W=[];this.W.offlineVideoStreams&&W.push.apply(W,g.ZX(this.W.offlineVideoStreams));this.W.captionTrack&&W.push.apply(W,g.ZX(this.W.captionTrack));return[].concat(g.ZX(new Set(W)))};
g.H(Qx9,yE);Qx9.prototype.K=function(){return[]};
g.H(yUK,yE);yUK.prototype.K=function(){return[]};
g.H(exQ,yE);exQ.prototype.K=function(){return[]};
g.H(odp,yE);odp.prototype.K=function(){return[]};
g.H(vdK,yE);vdK.prototype.K=function(){return[]};
g.H(C3B,yE);C3B.prototype.K=function(){return[]};
g.H(LQh,yE);LQh.prototype.K=function(){return[]};
g.H(UWz,yE);UWz.prototype.K=function(){return[]};
g.H(l4i,yE);l4i.prototype.K=function(){return[]};
g.H(bvi,yE);bvi.prototype.K=function(){return[]};
g.H(cUK,yE);cUK.prototype.K=function(){return[]};
g.H(xWc,yE);xWc.prototype.K=function(){return[]};
g.H(f4h,yE);f4h.prototype.K=function(){return[]};
g.H(V2Q,yE);V2Q.prototype.K=function(){return[]};
g.H(NgK,yE);NgK.prototype.K=function(){return[]};
g.H(a4i,yE);a4i.prototype.K=function(){return[]};
g.H(W$i,yE);W$i.prototype.K=function(){return[]};
g.H(Yv$,yE);Yv$.prototype.K=function(){return[]};
g.H($$h,yE);$$h.prototype.K=function(){return[]};
g.H(kuQ,yE);kuQ.prototype.K=function(){return[]};
g.H(PKh,yE);PKh.prototype.K=function(){return[]};
var kxz=["browse","music/browse","unplugged/browse"],Xei=["offline/playlist_sync_check"],cPK=["offline"],Ps9=["offline/offline_video_playback_position_sync"],jYc=["offline/get_playback_data_entity"],ef;oU.getInstance=function(){return g.D(function(W){return W.return(new Promise(function(Y){g.LJ().then(function(k){k?(oU.instance||(oU.instance=new oU(k)),Y(oU.instance)):Y(void 0)})}))})};
oU.prototype.get=function(W){var Y=this,k,P,T;return g.D(function(I){if(I.W==1)return g.m(I,Xa1(Y.token),2);if(I.W!=3)return k=I.K,g.m(I,k.get("prefs",W),3);P=I.K;if(!P)return I.return();T=(0,g.q5)();return P.expirationTimestampMs<=T?I.return():I.return(P.value)})};
oU.prototype.set=function(W,Y,k){k=k===void 0?31536E3:k;var P=this,T,I,X;return g.D(function(h){if(h.W==1)return T=(0,g.q5)(),I={key:W,value:Y,expirationTimestampMs:T+k*1E3},g.m(h,Xa1(P.token),2);X=h.K;return g.m(h,g.EP(X,"prefs",I),0)})};
oU.prototype.remove=function(W){var Y=this,k;return g.D(function(P){if(P.W==1)return g.m(P,Xa1(Y.token),2);k=P.K;return g.m(P,k.delete("prefs",W),0)})};
g.H(vX,g.Qq);g.H(C4,udp);C4.prototype.J=function(W,Y){Y=iMQ(Y);W=(new TextEncoder).encode(JSON.stringify(W));return this.W.encrypt(W,Y)};
C4.prototype.K=function(W,Y){if(!(W instanceof Uint8Array))throw Svp(1);var k=new TextDecoder;Y=iMQ(Y);W=this.W.decrypt(W,Y);return JSON.parse(k.decode(W))};
var Mdi={accountLinkStatusEntity:AWz,booleanEntity:HHK,buttonEntity:V2Q,captionTrack:zx1,channelHandle:tRK,chipEntity:LQh,commerceAcquisitionClientPayloadEntity:a4i,commerceCartListEntity:W$i,contextNoteFeedEntityPayload:qui,contextNoteUserRatingEntityPayload:Rgw,continuationTokenEntity:U4Q,downloadQualityPickerEntity:D4N,downloadsPageRefreshTokenEntity:F6z,downloadsPageViewConfigurationEntity:WQc,downloadStatusEntity:gez,dismissState:UWz,sfvAudioItemCurrentlyPlayingEntity:odp,emojiFountainDataEntity:xWc,
emojiCustomizationSetEntity:cUK,fakeChannel:pIh,fakePlaylist:G9K,fakePlaylistEntryCollection:EeN,fakeVideo:JWc,fakeVideoDescription:s5w,featuredProductsEntity:SJp,flowStateEntity:rW1,iconBadgeEntity:Yv$,interstitialInteractionStateEntity:d4z,likeButtonAnimationEntity:YJK,liveChatPollStateEntity:m4p,liveViewerLeaderboardChatEntryPointStateEntity:yUK,liveViewerLeaderboardPointsEntity:exQ,liveReactionsDataEntity:f4h,logoEntity:zgh,macroMarkerEntity:$Wc,mainDownloadsLibraryEntity:wIc,mainDownloadsListEntity:yW9,
mainPlaylistDownloadStateEntity:egc,mainPlaylistEntity:lvK,mainPlaylistVideoEntity:bHN,mainVideoDownloadStateEntity:oe$,mainVideoEntity:VRi,markersEngagementPanelSyncEntity:kR1,markersVisibilityOverrideEntity:P3c,musicAlbumReleaseDetail:t2z,musicAlbumReleaseDownloadMetadataEntity:Ovi,musicAlbumRelease:M21,musicAlbumReleaseUserDetail:qJh,musicArtistDetail:Hvc,musicArtist:Rxi,musicArtistUserDetail:nd9,musicDownloadsLibraryEntity:uA$,musicLibraryEdit:p9Q,musicLibraryStatusEntity:GRj,musicPlaylist:EdN,
musicPlaylistDownloadMetadataEntity:Zvz,musicShare:JU9,musicTrackDetail:rUQ,musicTrackDownloadMetadataEntity:ivc,musicTrack:sxB,musicTrackUserDetail:AUh,offlineOrchestrationActionWrapperEntity:dW9,offlineVideoPolicy:mWi,offlineVideoStreams:DWK,offlineabilityEntity:vec,orchestrationWebSamplingEntity:Cp9,pageHeaderEntity:l4i,pdpStateEntity:$$h,pinnedProductEntity:hxK,playbackData:gd$,playerStateEntity:TgN,quantityIncrementerEntity:kuQ,refresh:FQK,saveToPlaylistListEntity:vdK,selectedChipIndexEntityPayload:jx1,
settingEntity:C3B,stringEntity:ne1,suggestedFeedbackChipStateEntity:I41,transfer:w9i,trendingOfferEntity:BgB,videoDownloadContextEntity:Qx9,videoOverviewAsyncDataEntity:PKh,videoPlaybackPositionEntity:NgK,votingEntity:bvi,ytMainChannelEntity:NT$,youchatPendingResponseEntity:X9w,ytMainDownloadedVideoEntity:L69,ytMainVideoEntity:avp};g.H(xv,udp);xv.prototype.J=function(W){return W};
xv.prototype.K=function(W){if(W instanceof Uint8Array)throw Svp(0);return W};
g.H(f4,g.e);f4.prototype.observe=function(W){var Y=this;this.observers.push(W);return function(){var k=Y.observers.indexOf(W);k>=0&&Y.observers.splice(k,1)}};
f4.prototype.K=function(W){zPw(this,W.data)};
f4.prototype.iz=function(){this.channel.close()};
var F$Q,DaB=new g.qC("elementsCommand");var E3=new g.qC("entityBatchUpdate");var nAQ=new g.qC("downloadStatusEntity");var QhK=new g.qC("mainPlaylistEntityActionMetadata");var Vd=new g.qC("mainVideoEntityActionMetadata");var b_j=new g.qC("musicPlaylistEntityActionMetadata");var qiQ=new g.qC("musicTrackEntityActionMetadata");var aEK=new g.qC("localImageEntityActionMetadata");var wC=new g.qC("playbackDataActionMetadata");var gNB=new g.qC("transferEntityActionMetadata");var RZz=new g.qC("videoPlaybackPositionEntityActionMetadata");var Vd$;new g.Xd;new g.Xd;$aB.prototype.request=function(W,Y,k){Y=Y===void 0?{}:Y;return this.locks.request(W,Y,function(P){return k(P)})};var Px=g.V0.caches,kz,Ixh;$z.prototype.open=function(W){return Px.open(TOK(W))};
$z.prototype.has=function(W){return Px.has(TOK(W))};
$z.prototype.delete=function(W){return Px.delete(TOK(W))};
$z.prototype.match=function(W,Y){var k=this,P,T,I,X,h,B;return g.D(function(O){switch(O.W){case 1:return g.m(O,k.keys(),2);case 2:P=O.K,T=g.p(P),I=T.next();case 3:if(I.done){O.oi(5);break}X=I.value;return g.m(O,k.open(X),6);case 6:return h=O.K,g.m(O,h.match(W,Y),7);case 7:if(B=O.K)return O.return(B);I=T.next();O.oi(3);break;case 5:return O.return()}})};
g.H(P9w,$z);P9w.prototype.keys=function(){var W,Y,k,P,T,I,X,h,B;return g.D(function(O){if(O.W==1)return W=[],Y=g.yq("CacheStorage keys"),g.m(O,Px.keys(),2);k=O.K;P=g.p(k);for(T=P.next();!T.done;T=P.next()){I=T.value;var u=I.indexOf(":");X=u===-1?{f_:I}:{f_:I.substring(0,u),datasyncId:I.substring(u+1)};h=X.f_;B=X.datasyncId;B===Y&&W.push(h)}return O.return(W)})};g.H(jL,g.e);jL.prototype.J=function(W){this.api.Ri("onOfflineOperationFailure",W.data)};
jL.prototype.T=function(W){this.api.publish("offlinetransferpause",W.data)};
jL.prototype.iz=function(){var W;(W=this.W)==null||W.close();var Y;(Y=this.K)==null||Y.close()};hT1.prototype.R6=function(){this.W&&X3(this)};
hT1.prototype.SZ=function(){this.K&&this.K.resolve();this.J=this.W=!1;this.N()};var VQp=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var zTi="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var vAi="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.H(hZB,DI);hZB.prototype.K=function(W){return O3(W)?uuK(this,W):uR(W)?MQK(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};g.H(tQN,DI);tQN.prototype.K=function(W){return uR(W)?qrK(this,W):H_w(W)?Ho1(this,W):ZI(W)?nNh(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};g.R=pew.prototype;g.R.O15=function(W){var Y=this,k,P,T,I;return g.D(function(X){if(!g.b(W.state,128))return X.oi(0);k=W.state.dc;var h=(P=k)==null?void 0:P.errorCode,B=(T=k)==null?void 0:T.AI;I=h==="net.connect"&&B===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(h==null?0:h.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.m(X,Y.kX(Y.player.getVideoData().videoId,I),0)})};
g.R.kX=function(W,Y){var k=this;return g.D(function(P){if(P.W==1){if(k.K)return P.return();k.K=!0;return Y==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(eL(k,W,!1,!0),P.oi(0)):g.m(P,yd(k,W),3)}g.Pn(W,4);return g.m(P,k.W.kX(Y),0)})};
g.R.OO=function(W){W.status===2?(W.status!==this.J&&(qQi(this.W),g.Pn(W.videoId,2)),W.Fh&&Gsw(this.W,W.videoId,W.Fh)):W.status===4?(yd(this,W.videoId),this.kX(W.videoId,W.Au?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):W.status===1&&pDi(this.W);this.J=W.status;this.api.Ri("localmediachange",{videoId:W.videoId,status:W.status})};
g.R.zD=function(){var W=this,Y;return g.D(function(k){if(k.W==1){if(W.K)return k.return();W.K=!0;Y=W.player.getVideoData().videoId;return g.m(k,yd(W,Y),2)}return g.m(k,W.W.zD(),0)})};
g.R.Yc=function(W){switch(W){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.R.U=function(W){return this.api.V().U(W)};g.H(A4Q,DI);A4Q.prototype.K=function(W){return O3(W)?d9$(this,W):uR(W)?m9Q(this,W):H_w(W)?D9K(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};eZ$.prototype.W=function(W,Y){var k=W.action.actionMetadata.priority-Y.action.actionMetadata.priority;k===0&&(W.W<Y.W?k=-1:W.W>Y.W&&(k=1));return k};g.H(o$,g.e);o$.prototype.iz=function(){this.N&&this.N();g.e.prototype.iz.call(this)};
o$.prototype.createAction=function(W,Y){var k=g.cg(W.entityKey).entityType,P=g.OY(16);return new R$(k,P,W,Y.actionId,Y.rootActionId)};
o$.prototype.Kg=function(W){var Y=this,k,P,T,I,X,h,B,O,u;return g.D(function(Z){if(Z.W==1){if(Y.Xr())return Z.return();P=(k=W.offlineOrchestrationActionWrapperEntity)!=null?k:new Set;T=[];I=g.p(P);for(X=I.next();!X.done;X=I.next())h=X.value,B=g.cg(h),O=B.entityId,Csj(Y.W,O)||T.push(h);return g.m(Z,Wyi(Y,T),2)}u=Z.K;return g.m(Z,a3K(Y,u),0)})};
o$.prototype.retry=function(){var W=this;return g.D(function(Y){return g.m(Y,YQi(W),0)})};ksc.prototype.BU=function(W,Y){Y=Y===void 0?!0:Y;var k=this,P,T,I,X,h,B,O,u;return g.D(function(Z){switch(Z.W){case 1:if(!k.W)return Z.return();P=[];T=g.jJ(k.W.K,Y);I=[];for(X={C0:0};X.C0<T.length;X={C0:X.C0},X.C0++)h=T[X.C0],B=k.W.Yt(h,"json3"),O=g.nN(B,{withCredentials:!0,format:"RAW"},3,500).then(function(M){return function(t){t={metadata:g.Ch(T[M.C0]),trackData:t.xhr.responseText};I.push(t)}}(X)).MA(function(M){TU("Caption fetch error",M)}),P.push(O);
return g.m(Z,MR$(P),2);case 2:return g.KC(Z,3),g.m(Z,L$h(W,I),5);case 5:g.s2(Z,0);break;case 3:u=g.Aq(Z),TU("Caption DB transaction error",u),g.G1(Z)}})};g.H(vx,g.e);vx.prototype.iz=function(){this.K&&this.K();g.e.prototype.iz.call(this)};
vx.prototype.J=function(W){var Y=this,k,P,T,I,X,h,B,O;return g.D(function(u){P=(k=W.transfer)!=null?k:new Set;T=[];I=g.p(P);for(X=I.next();!X.done;X=I.next())h=X.value,B=g.cg(h),O=B.entityId,T.push(O);return T.length===0?u.return():g.m(u,jh9(Y,T),0)})};g.H(BF$,g.e);g.R=BF$.prototype;g.R.iz=function(){this.wD&&this.wD();this.gD.dispose();this.T.dispose();this.UP&&g.cI(this.X.n7,this.UP);this.OP&&g.cI(this.X.n7,this.OP);g.e.prototype.iz.call(this)};
g.R.zz5=function(W){var Y=this,k,P,T;return g.D(function(I){switch(I.W){case 1:k=g.xS(W,"transfer");if(Y.W&&k===Y.W.key){eL(Y.G,Y.C,!0);Y.T.stop();I.oi(0);break}return g.m(I,VE(Y.K,{mode:"readwrite",sR:!0},function(X){return L4(X,k,"transfer").then(function(h){if(h&&h.transferState!=="TRANSFER_STATE_COMPLETE"&&h.transferState!=="TRANSFER_STATE_FAILED")return h.transferState="TRANSFER_STATE_PAUSED_BY_USER",bc(X,h,"transfer").then(function(){return h})})}),3);
case 3:P=I.K;if(!P){I.oi(0);break}if(!W||!Y.J){I.oi(5);break}return g.m(I,iR(W,Y.J,Y.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.m(I,U3(Y,W),7);case 7:T=I.K,qUQ({videoId:W,hj:P,offlineModeType:T}),g.G1(I)}})};
g.R.MLJ=function(){var W=this;if(this.W&&this.C){eL(this.G,this.C,!1);var Y=this.W,k=(Y==null?0:Y.key)?g.cg(Y.key).entityId:"";k&&this.J&&(new Promise(function(P,T){iR(k,W.J,W.K,"DOWNLOAD_STATE_PAUSED").catch(function(I){T(I)})})).catch(function(P){TU("Download state setting error",P)})}this.T.stop()};
g.R.WB=function(){this.W?ZIp(this,this.W):Lp(this)};
g.R.UC=function(W){var Y=this;return g.D(function(k){switch(k.W){case 1:if(!Y.W){k.oi(2);break}if(Y.W.transferState==="TRANSFER_STATE_COMPLETE"||Y.W.transferState==="TRANSFER_STATE_FAILED"||!W.transfer||!W.transfer.has(Y.W.key)){k.oi(3);break}return g.m(k,aU(Y.K,Y.W.key,"transfer"),4);case 4:Y.W=k.K;if(Y.W){k.oi(3);break}return g.m(k,iI$(Y),3);case 3:if(Y.W)return k.return();case 2:return g.m(k,Lp(Y),0)}})};
g.R.kX=function(W,Y){var k=this,P,T,I,X,h;return g.D(function(B){switch(B.W){case 1:if(!k.W){lR(k,"onTransferFailure: "+W);B.oi(2);break}P=k.W;I=((T=P)==null?0:T.key)?g.cg(P.key).entityId:"";a:switch(W){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var O=!1;break a;default:O=!0}return O&&KyB(k)?g.m(B,bR(k,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.m(B,
EKj(k,W),5);case 5:if(!I||!k.J){B.oi(2);break}return g.m(B,iR(I,k.J,k.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.m(B,U3(k,I),9);case 9:X=B.K;hs({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:I,hj:P,offlineModeType:X});if(!I||!k.J){B.oi(2);break}return g.m(B,iR(I,k.J,k.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Cp(k),h=Lp(k,!0),Y&&Y(h),g.G1(B)}})};
g.R.zD=function(W){var Y=this,k,P,T,I,X,h,B,O,u,Z,M,t;return g.D(function(q){switch(q.W){case 1:if(!Y.W){lR(Y,"onMaybeTransferStreamsExpired");q.oi(2);break}return KyB(Y)?g.m(q,bR(Y,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.m(q,EKj(Y,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!Y.J){q.oi(2);break}k=Y.W;T=((P=k)==null?0:P.key)?g.cg(k.key).entityId:"";if(!T){q.oi(2);break}return g.m(q,iR(T,Y.J,Y.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return Y.W||lR(Y,"onMaybeTransferStreamsExpiredRetryAttempting"),
I=Y.W,h=((X=I)==null?0:X.key)?g.cg(I.key).entityId:"",g.m(q,U3(Y,h),10);case 10:return B=q.K,hs({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:h,hj:I,offlineModeType:B}),O=KYQ(),g.Ah(O,wC,{isEnqueuedForExpiredStreamUrlRefetch:!0}),u=g.xS(h,"playbackData"),Z={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:u,actionMetadata:O},M=np(new R$("playbackData",h,Z)),g.m(q,N1(Y.K,M,"offlineOrchestrationActionWrapperEntity"),2);case 2:Cp(Y),t=Lp(Y,!0),
W&&W(t),g.G1(q)}})};
var ABK={},JrK=(ABK.TRANSFER_STATE_TRANSFERRING=1,ABK.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,ABK);g.R=cx.prototype;g.R.m6=function(){return this.C.promise};
g.R.z6=function(){if(this.K&&this.G)return this.C.promise;ArK(this).then(this.C.resolve).catch(this.C.reject);return this.C.promise};
g.R.FR=function(W){var Y={};return Y.playbackData=new hZB(W,this.zJ,this.W),Y.transfer=new A4Q(W,this.zJ),Y.videoPlaybackPositionEntity=new tQN(W,this.zJ),Y};
g.R.ox=function(){var W=this;return g.D(function(Y){return W.K?g.m(Y,OIi(W.K),0):Y.oi(0)})};
g.R.ye=function(){var W=this,Y,k;return g.D(function(P){if(P.W==1)return W.K||W.G?g.m(P,W.m6(),2):P.return();W.L!==void 0&&(g.hB(W.L),W.L=void 0);W.T!==void 0&&(g.hB(W.T),W.T=void 0);(Y=W.K)==null||Y.dispose();W.K=void 0;(k=W.G)==null||k.dispose();W.G=void 0;W.api.Ri("onOrchestrationLostLeader");W.C=new g.Xd;g.G1(P)})};
g.R.isOrchestrationLeader=function(){return this.J.W};
g.R.nD=function(){return g.D(function(W){return W.return(!1)})};
g.R.qO=function(W){var Y=this.W;Y.api.publish("offlinetransferpause",W);var k;(k=Y.K)==null||k.postMessage(W)};
g.R.WB=function(W){var Y,k;return g.D(function(P){if(P.W==1)return g.m(P,Yz(),2);Y=P.K;if(!Y)return P.return();k=g.xS(W,"transfer");return g.m(P,VE(Y,{mode:"readwrite",sR:!0},function(T){var I=L4(T,k,"transfer"),X=L4(T,g.xS(W,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.ZS.all([I,X]).then(function(h){h=g.p(h);var B=h.next().value;var O=h.next().value;return B&&B.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(B.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",bc(T,B,"transfer").then(function(){hs({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:W,hj:B,offlineModeType:O==null?void 0:O.offlineModeType});return g.ZS.resolve(null)})):g.ZS.resolve(null)})}),0)})};
g.R.eO=function(W){W=W===void 0?43200:W;var Y=this,k,P,T,I,X,h,B,O;return g.D(function(u){if(u.W==1)return Y.X.s6()?g.m(u,Yz(),2):u.return(zVc());if(u.W!=3){k=u.K;if(!k)return u.return([]);P=Date.now()/1E3;return g.m(u,Wx(k,"offlineVideoPolicy"),3)}T=u.K;I=[];X=g.p(T);for(h=X.next();!h.done;h=X.next())B=h.value,Number(B.lastUpdatedTimestampSeconds)+W<=P&&(O=g.cg(B.key).entityId,I.push(O));return I.length?u.return(xz(Y,I,Y.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):u.return([])})};
g.R.deleteAll=function(){return xz(this,["!*$_ALL_ENTITIES_!*$"],this.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.R.refreshAllStaleEntities=function(W){var Y=this;return g.D(function(k){return k.W==1?g.m(k,Y.eO(W),2):k.return(k.K)})};
g.R.setUpPositionSyncInterval=function(W){var Y=this;this.T!==void 0&&(g.hB(this.T),this.T=void 0);var k=W!=null?W:864E5;this.T=g.XU(function(){Y.zL(k)},k)};
g.R.zL=function(W){var Y=this,k,P,T,I,X,h;return g.D(function(B){switch(B.W){case 1:return g.KC(B,2),g.m(B,oU.getInstance(),4);case 4:k=B.K;if(!k)throw Error("prefStorage is undefined");return g.m(B,k.get("psi"),5);case 5:P=B.K;I=((T=P)==null?0:T.hc)?Number(P.hc)/1E3:0;X=Date.now();if(!(I+W<=X)){B.oi(6);break}return g.m(B,xz(Y,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.s2(B,0);break;case 2:h=g.Aq(B),TU("Offline manager error",h),
g.G1(B)}})};
g.R.Pc=function(){var W=this,Y,k,P,T,I,X,h;return g.D(function(B){if(B.W==1)return g.m(B,Yz(),2);if(B.W!=3)return(Y=B.K)?g.m(B,Wx(Y,"transfer"),3):B.return([]);k=B.K;P=[];T=g.p(k);for(I=T.next();!I.done;I=T.next())X=I.value,X.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&X.key&&(h=g.cg(X.key).entityId,P.push(h));return B.return(mCc(W,P))})};
g.R.AM=function(){return g.D(function(W){return W.return([])})};
g.R.w6=function(){return g.D(function(W){g.G1(W)})};
g.R.Hf=function(){return g.D(function(W){g.G1(W)})};g.H(DCz,DI);DCz.prototype.K=function(W){return O3(W)?wDc(this,W):uR(W)?yrz(this,W):ZI(W)?eVw(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};
var fp=[10];g.H(UC$,DI);UC$.prototype.K=function(W){return O3(W)?crz(this,W):uR(W)?xCQ(this,W):ZI(W)?fE1(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};
var bIw=[10];g.H(NFw,DI);NFw.prototype.K=function(W){return uR(W)?Wf1(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};g.H(Yii,cx);g.R=Yii.prototype;g.R.FR=function(W){var Y=cx.prototype.FR.call(this,W);Y.mainVideoEntity=new UC$(W,this.zJ,this.W);Y.mainPlaylistEntity=new DCz(W,this.zJ,this.W);Y.mainDownloadsListEntity=new NFw(W,this.zJ,this.W);return Y};
g.R.refreshAllStaleEntities=function(W,Y){var k=this,P,T,I,X,h,B,O,u,Z,M,t;return g.D(function(q){switch(q.W){case 1:P=[];if(!k.zJ.U("web_player_offline_playlist_auto_refresh")){q.oi(2);break}return g.m(q,$Kh(k,W,Y),3);case 3:P=q.K;case 2:return g.m(q,oU.getInstance(),4);case 4:return T=q.K,g.m(q,(I=T)==null?void 0:I.get("sdois"),5);case 5:return X=q.K,g.m(q,(h=T)==null?void 0:h.get("lmqf"),6);case 6:B=q.K;if(!X){q.oi(7);break}u=P;Z=u.concat;return g.m(q,k5p(k,X,(O=B)!=null?O:"SD",W===0),8);case 8:P=
Z.call(u,q.K);case 7:return M=P,t=M.concat,g.m(q,cx.prototype.refreshAllStaleEntities.call(k,W,Y),9);case 9:return P=t.call(M,q.K),q.return(P)}})};
g.R.nD=function(W){var Y,k,P,T,I,X,h,B;return g.D(function(O){if(O.W==1)return g.m(O,Yz(),2);if(O.W!=3)return(Y=O.K)?g.m(O,aU(Y,g.eF,"mainDownloadsListEntity"),3):O.return(!1);k=O.K;if((P=k)==null?0:(T=P.downloads)==null?0:T.length)for(I=g.xS(W,"mainVideoEntity"),X=g.p(k.downloads),h=X.next();!h.done;h=X.next())if(B=h.value,B.videoItem===I)return O.return(!0);return O.return(!1)})};
g.R.AM=function(){var W=this,Y,k,P,T,I,X,h,B;return g.D(function(O){if(O.W==1)return g.m(O,Yz(),2);if(O.W!=3)return(Y=O.K)?g.m(O,Wx(Y,"downloadStatusEntity"),3):O.return([]);k=O.K;P=[];T=g.p(k);for(I=T.next();!I.done;I=T.next())X=I.value,X.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&X.key&&(h=g.cg(X.key).entityId,P.push(h));return P.length?(B={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},O.return(xz(W,P,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
B))):O.return([])})};
g.R.Hf=function(){var W;return g.D(function(Y){return Y.W==1?g.m(Y,Yz(),2):(W=Y.K)?g.m(Y,VE(W,{mode:"readwrite",sR:!0},function(k){return UB(k,"mainVideoEntity").then(function(P){var T=[];P=g.p(P);for(var I=P.next();!I.done;I=P.next()){I=I.value;var X=void 0;(X=I.userState)!=null&&X.playbackPosition||(X=g.cg(I.key).entityId,X={key:g.xS(X,"videoPlaybackPositionEntity"),videoId:X,lastPlaybackPositionSeconds:"0"},T.push(bc(k,X,"videoPlaybackPositionEntity")),I.userState={playbackPosition:X.key},T.push(bc(k,
I,"mainVideoEntity")))}return g.ZS.all(T)})}),0):Y.return()})};
g.R.w6=function(){var W,Y,k,P,T,I,X,h,B,O,u,Z,M,t,q,G,J,d,A,F,y,L,V,c,X7,Id,Sz,O2,$5,z1,cd,ad,Mc,Ij,mV,jV,wB,L$;return g.D(function(Iq){if(Iq.W==1)return g.m(Iq,Yz(),2);if(Iq.W!=3){W=Iq.K;if(!W)return Iq.return();Y=g.xS("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.m(Iq,VE(W,{mode:"readonly",sR:!0},function(z){return g.ZS.all([L4(z,Y,"mainDownloadsListEntity"),L4(z,g.eF,"mainDownloadsListEntity"),UB(z,"mainVideoEntity"),UB(z,"mainPlaylistEntity")])}),3)}k=Iq.K;
P=g.p(k);T=P.next().value;I=P.next().value;X=P.next().value;h=P.next().value;B=T;O=I;u=X;Z=h;M=new Set;if((t=B)==null?0:(q=t.downloads)==null?0:q.length)for(G=g.p(B.downloads),J=G.next();!J.done;J=G.next())d=J.value,A=void 0,(F=(A=d.videoItem)!=null?A:d.playlistItem)&&M.add(F);if((y=O)==null?0:(L=y.downloads)==null?0:L.length)for(V=g.p(O.downloads),c=V.next();!c.done;c=V.next())X7=c.value,X7.videoItem&&M.add(X7.videoItem);Id=new Set;Sz=[];O2=g.p(Z);for($5=O2.next();!$5.done;$5=O2.next()){z1=$5.value;
if(z1.videos)for(cd=g.p(z1.videos),ad=cd.next();!ad.done;ad=cd.next())Mc=ad.value,(Ij=JSON.parse(g.cg(Mc).entityId).videoId)&&Id.add(Ij);z1.key&&!M.has(z1.key)&&Sz.push(z1.key)}mV=g.p(u);for(jV=mV.next();!jV.done;jV=mV.next())wB=jV.value,wB.key&&!M.has(wB.key)&&(L$=g.cg(wB.key).entityId,Id.has(L$)||Sz.push(wB.key));return Sz.length?g.m(Iq,Q2N(W,Sz),0):Iq.oi(0)})};g.H(PwQ,DI);PwQ.prototype.K=function(W){return O3(W)?jiw(this,W):uR(W)?IJw(this,W):ZI(W)?Xyw(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};
var NM=[10];g.H(hE1,DI);hE1.prototype.K=function(W){return O3(W)?ONw(this,W):uR(W)?uUc(this,W):ZI(W)?ZNw(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};
var a$=[10];g.H(tUz,DI);tUz.prototype.K=function(W){return O3(W)?nG1(this,W):uR(W)?py$(this,W):ZI(W)?G5z(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};
var HNp=[10];g.H(WY,cx);WY.prototype.FR=function(W){var Y=cx.prototype.FR.call(this,W);Y.musicTrack=new tUz(W,this.W);Y.musicPlaylist=new hE1(W,this.W);Y.musicAlbumRelease=new PwQ(W,this.W);return Y};
WY.prototype.refreshAllStaleEntities=function(W,Y){var k=this,P,T,I;return g.D(function(X){if(X.W==1)return g.m(X,EGj(k,W,Y),2);if(X.W!=3)return T=P=X.K,I=T.concat,g.m(X,cx.prototype.refreshAllStaleEntities.call(k,W,Y),3);P=I.call(T,X.K);return X.return(P)})};g.H(JB$,g.JJ);g.R=JB$.prototype;g.R.create=function(){var W=this;g.v(this,this.events);if(g.ph(this.zJ))this.W=new Yii(this.zJ,this.player);else if(g.dq(this.zJ)||g.Kh(this.zJ))this.W=new WY(this.zJ,this.player);this.events.Z(this.player,"onPlaybackStartExternal",function(){W.FO()});
this.events.Z(this.player,"videodatachange",function(){W.FO()});
this.zJ.U("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.Ac)};
g.R.bE=function(){return!1};
g.R.j_=function(W,Y,k,P){var T=this;return g.D(function(I){return T.W?I.return(xz(T.W,W,Y,k,P)):I.return(Promise.reject())})};
g.R.deleteAll=function(){return this.W.deleteAll()};
g.R.eO=function(W){return this.W.eO(W)};
g.R.refreshAllStaleEntities=function(W){return this.W.refreshAllStaleEntities(W)};
g.R.setUpPositionSyncInterval=function(W){this.W.setUpPositionSyncInterval(W)};
g.R.qO=function(W){this.W.qO(W)};
g.R.WB=function(W){return this.W.WB(W)};
g.R.FO=function(){var W=this,Y;return g.D(function(k){Y=W.player.getVideoData();return g.qq(Y)?siB(Y)&&W.K!==Y.clientPlaybackNonce?g.m(k,rBB(W,Y),0):k.oi(0):k.return()})};
g.R.Ac=function(W){var Y=this,k,P,T,I,X,h,B;return g.D(function(O){if(O.W==1)return k=Y.player.getVideoData(),P=k.UV,g.Sa(W,2)||g.Sa(W,512)?g.m(O,Yz(),2):O.return();if(O.W!=3){T=O.K;if(!T)return TU("PES is undefined"),O.return();I=k.videoId;return g.m(O,aU(T,g.xS(I,"mainVideoEntity"),"mainVideoEntity"),3)}X=O.K;if(!X)return O.return();h=Math.floor(P).toString();B={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:h}};return g.m(O,Y.j_([I],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
B),0)})};
g.R.isOrchestrationLeader=function(){return this.W.isOrchestrationLeader()};
g.R.updateDownloadState=function(W,Y){var k,P,T,I;return g.D(function(X){if(X.W==1)return g.m(X,Yz(),2);k=X.K;if(!k)return TU("PES is undefined"),X.return();P=g.cg(W);T=P.entityType;I=P.entityId;return g.m(X,iR(I,T,k,Y,!0),0)})};g.EX("offline",JB$);})(_yt_player);
